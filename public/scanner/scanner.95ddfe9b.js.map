{"mappings":"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","sources":["<anon>","src/index.ts","src/process.ts","node_modules/@parcel/runtime-js/lib/runtime-5ab21ace64de5c0c.js","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","src/pdf.ts","src/io.ts","node_modules/@parcel/runtime-js/lib/runtime-76138e2a9a442681.js","node_modules/@parcel/runtime-js/lib/runtime-ffe1a1b4b6daa25b.js","node_modules/@parcel/runtime-js/lib/runtime-0805f8303488d9e0.js","node_modules/@parcel/runtime-js/lib/runtime-a0caa4fa49da3bf2.js","node_modules/image-capture/src/imagecapture.js","node_modules/@parcel/runtime-js/lib/runtime-171e623f1dde3c53.js","node_modules/@parcel/runtime-js/lib/runtime-e6508d17fff70a8d.js"],"sourcesContent":["\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\nvar $4a0c81f9764a7da6$exports = {};\nvar $56b621a6dd25b2cb$exports = {};\n\"use strict\";\n$56b621a6dd25b2cb$exports = function(workerUrl, origin, isESM) {\n    if (origin === self.location.origin) // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n    else {\n        // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n        var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n        return URL.createObjectURL(new Blob([\n            source\n        ], {\n            type: 'application/javascript'\n        }));\n    }\n};\n\n\nlet $4a0c81f9764a7da6$var$url = new URL(import.meta.resolve(\"a2Cve\"));\n$4a0c81f9764a7da6$exports = $56b621a6dd25b2cb$exports($4a0c81f9764a7da6$var$url.toString(), $4a0c81f9764a7da6$var$url.origin, true);\n\n\nconst $191e7775e3189472$var$newWorker = ()=>new Worker($4a0c81f9764a7da6$exports);\nconst $191e7775e3189472$var$processWorkers = [];\nif (navigator.hardwareConcurrency) for(let i = 1; i < navigator.hardwareConcurrency; ++i)$191e7775e3189472$var$processWorkers.push($191e7775e3189472$var$newWorker());\nconst $191e7775e3189472$var$getWorker = ()=>$191e7775e3189472$var$processWorkers.pop() || $191e7775e3189472$var$newWorker();\nconst $191e7775e3189472$var$returnWorker = (worker)=>$191e7775e3189472$var$processWorkers.push(worker);\nlet $191e7775e3189472$var$messageID = 0;\nconst $191e7775e3189472$var$message = async (msg, transfer)=>{\n    return new Promise((resolve, reject)=>{\n        const worker = $191e7775e3189472$var$getWorker();\n        let id = $191e7775e3189472$var$messageID++;\n        // const ts = performance.now();\n        const onMessage = (evt)=>{\n            const { id: mid, error: error, result: result } = evt.data;\n            if (mid == id) {\n                if (error) {\n                    let err = new Error(error.message);\n                    err.stack = error.stack;\n                    err.name = error.name;\n                    reject(err);\n                } else resolve(result);\n                // console.log('Processed', msg, 'in', (performance.now() - ts) + 'ms', { result, error });\n                $191e7775e3189472$var$returnWorker(worker);\n                worker.removeEventListener(\"message\", onMessage);\n            }\n        };\n        worker.addEventListener(\"message\", onMessage);\n        worker.postMessage({\n            id: id,\n            msg: msg\n        }, transfer || []);\n    });\n};\nfunction $191e7775e3189472$export$c5fefc891e91de4b(data, transfer) {\n    return $191e7775e3189472$var$message({\n        type: \"find-document\",\n        data: data\n    }, transfer ? [\n        data.data.buffer\n    ] : []);\n}\nfunction $191e7775e3189472$export$ab8ba24d4c0c8986(data, region, targetWidth, targetHeightOrTransfer, maybeTransfer) {\n    // Determine if the 4th argument is a height or a transfer flag\n    let targetHeight;\n    let transfer;\n    if (typeof targetHeightOrTransfer === \"number\") {\n        targetHeight = targetHeightOrTransfer;\n        transfer = Boolean(maybeTransfer);\n    } else transfer = Boolean(targetHeightOrTransfer);\n    // Build the message payload\n    const payload = {\n        type: \"extract-document\",\n        data: data,\n        region: region,\n        targetWidth: targetWidth\n    };\n    if (targetHeight !== undefined) payload.targetHeight = targetHeight;\n    return $191e7775e3189472$var$message(payload, transfer ? [\n        data.data.buffer\n    ] : []);\n}\nfunction $191e7775e3189472$export$6806abd6abc725de(bitmap, transfer) {\n    return $191e7775e3189472$var$message({\n        type: \"get-data\",\n        bitmap: bitmap\n    }, transfer ? [\n        bitmap\n    ] : []);\n}\n\n\n/// <reference lib=\"dom\" />\n/// <reference lib=\"es2017\" />\n// In browser/worker, process may not exist; guard its usage\nconst $98ce8732f7dffb75$var$readFile = Blob.prototype.arrayBuffer || function() {\n    return new Promise((resolve, reject)=>{\n        const fr = new FileReader();\n        fr.onload = ()=>{\n            resolve(fr.result);\n        };\n        fr.onerror = ()=>{\n            reject(fr.error);\n        };\n        fr.readAsArrayBuffer(this);\n    });\n};\nconst $98ce8732f7dffb75$export$99fdcdff3bb1ad24 = async (images)=>{\n    const pdfChunks = [];\n    let index = 0;\n    const offsets = [];\n    const write = (chunk)=>{\n        pdfChunks.push(chunk);\n        index += chunk.length;\n    };\n    const token = (chunk)=>{\n        write(\" \");\n        write(chunk);\n    };\n    const concat = (chunks)=>{\n        let len = 0;\n        for (const chunk of chunks)len += chunk.length;\n        const buf = new Uint8Array(len);\n        len = 0;\n        for (const chunk of chunks){\n            if (typeof chunk == \"string\") for(let i = 0; i < chunk.length; ++i)buf[i + len] = chunk.charCodeAt(i);\n            else buf.set(chunk, len);\n            len += chunk.length;\n        }\n        return buf;\n    };\n    // Convenience functions\n    const comment = (content)=>{\n        write(\"%\" + content + \"\\n\");\n    };\n    const number = (value)=>{\n        // Note: this doesnt work for very small and very large numbers\n        token(value.toString());\n    };\n    const ascii = (value)=>{\n        token(\"(\" + value.replace(/[\\n\\r\\t\\f\\b\\(\\)\\\\]/g, (c)=>\"\\\\00\" + c.charCodeAt(0).toString(8)) + \")\");\n    };\n    const bin = (value)=>{\n        let data = \"<\";\n        if (typeof value == \"string\") for(let i = 0; i < value.length; ++i)data += value.charCodeAt(i).toString(16);\n        else for(let i = 0; i < value.length; ++i)data += value[i].toString(16);\n        token(data + \">\");\n    };\n    const name = (value)=>{\n        // Note: only supports ASCII names\n        token(\"/\" + value);\n    };\n    const array = (fn)=>{\n        token(\"[\");\n        fn();\n        token(\"]\");\n    };\n    const dict = (values)=>{\n        token(\"<<\");\n        for(const key in values){\n            name(key);\n            values[key]();\n        }\n        token(\">>\");\n    };\n    const stream = (desc, content)=>{\n        // Only assert in non-production when process.env is available\n        if (typeof process !== \"undefined\" && process.env != null && process.env.NODE_ENV !== \"production\") {\n            if (!desc[\"Length\"]) throw new TypeError(\"need stream length\");\n        }\n        dict(desc);\n        token(\"stream\\n\");\n        write(content);\n        write(\"endstream\");\n    };\n    const object = (fn)=>{\n        write(\" \");\n        write(offsets.push(index) + \" 0 obj\");\n        fn();\n        token(\"endobj\");\n        return offsets.length;\n    };\n    const reference = (id)=>{\n        token(id + \" 0 R\");\n    };\n    const nullObject = ()=>{\n        token(\"null\");\n    };\n    // v1.4 for compatibility\n    comment(\"PDF-1.4\");\n    // 4 byte binary comment, as suggested by spec\n    comment(\"\\x90\\x85\\xfa\\xe3\");\n    const pagesRootId = images.length * 3 + 1;\n    const pages = await Promise.all(images.map(async (img)=>{\n        // Convert ImageData to JPEG binary\n        let jpegBlob;\n        if (typeof OffscreenCanvas !== \"undefined\") {\n            const offscreen = new OffscreenCanvas(img.width, img.height);\n            const ctx = offscreen.getContext(\"2d\");\n            ctx.putImageData(img, 0, 0);\n            jpegBlob = await offscreen.convertToBlob({\n                type: \"image/jpeg\"\n            });\n        } else if (typeof document !== \"undefined\") {\n            const htmlCanvas = document.createElement(\"canvas\");\n            htmlCanvas.width = img.width;\n            htmlCanvas.height = img.height;\n            const ctx = htmlCanvas.getContext(\"2d\");\n            ctx.putImageData(img, 0, 0);\n            jpegBlob = await new Promise((resolve)=>htmlCanvas.toBlob(resolve, \"image/jpeg\"));\n        } else throw new Error(\"Cannot generate JPEG: no canvas or document available in worker context\");\n        const jpegData = new Uint8Array(await $98ce8732f7dffb75$var$readFile.call(jpegBlob));\n        const image = object(()=>{\n            stream({\n                Type () {\n                    name(\"XObject\");\n                },\n                Subtype () {\n                    name(\"Image\");\n                },\n                Width () {\n                    number(img.width);\n                },\n                Height () {\n                    number(img.height);\n                },\n                ColorSpace () {\n                    name(\"DeviceRGB\");\n                },\n                BitsPerComponent () {\n                    number(8);\n                },\n                Filter () {\n                    name(\"DCTDecode\");\n                },\n                Length () {\n                    number(jpegData.length);\n                }\n            }, jpegData);\n        });\n        // US Letter width\n        const height = 792;\n        const width = height * img.width / img.height;\n        const contents = object(()=>{\n            const result = `${width} 0 0 ${height} 0 0 cm /I Do`;\n            stream({\n                Length () {\n                    number(result.length);\n                }\n            }, concat([\n                result\n            ]));\n        });\n        const page = object(()=>{\n            dict({\n                Type () {\n                    name(\"Page\");\n                },\n                Parent () {\n                    reference(pagesRootId);\n                },\n                Resources () {\n                    dict({\n                        XObject () {\n                            dict({\n                                I () {\n                                    reference(image);\n                                }\n                            });\n                        }\n                    });\n                },\n                Contents () {\n                    reference(contents);\n                },\n                MediaBox () {\n                    array(()=>{\n                        number(0);\n                        number(0);\n                        number(width);\n                        number(height);\n                    });\n                }\n            });\n        });\n        return page;\n    }));\n    const pageRoot = object(()=>{\n        dict({\n            Type () {\n                name(\"Pages\");\n            },\n            Kids () {\n                array(()=>{\n                    for (const page of pages)reference(page);\n                });\n            },\n            Count () {\n                number(pages.length);\n            }\n        });\n    });\n    const catalog = object(()=>{\n        dict({\n            Type () {\n                name(\"Catalog\");\n            },\n            Pages () {\n                reference(pageRoot);\n            }\n        });\n    });\n    // XREF\n    write(\"\\n\");\n    const xrefOffset = index;\n    write(\"xref\\n0 \" + (offsets.length + 1) + \"\\n0000000000 65535 f \\n\");\n    for (const offset of offsets)write(offset.toString().padStart(10, \"0\") + \" 00000 n \\n\");\n    write(\"trailer\");\n    dict({\n        Size () {\n            number(offsets.length + 1);\n        },\n        Root () {\n            reference(catalog);\n        }\n    });\n    write(\"\\nstartxref\\n\" + xrefOffset + \"\\n%%EOF\");\n    return concat(pdfChunks);\n};\n\n\n\nconst $aa7f0fbc084e0a0e$export$85ada9a21afbeab6 = async (img)=>{\n    const elem = document.createElement(\"img\");\n    const loaded = new Promise((resolve, reject)=>{\n        elem.onload = ()=>{\n            resolve();\n        };\n        elem.onerror = (err)=>{\n            reject(err);\n        };\n    });\n    elem.src = URL.createObjectURL(img);\n    await loaded;\n    URL.revokeObjectURL(elem.src);\n    return elem;\n};\nconst $aa7f0fbc084e0a0e$var$sharedCanvas = document.createElement(\"canvas\");\nconst $aa7f0fbc084e0a0e$var$sharedCtx = $aa7f0fbc084e0a0e$var$sharedCanvas.getContext(\"2d\");\nconst $aa7f0fbc084e0a0e$export$7a171f172be0782e = async (img, transfer)=>{\n    if ($aa7f0fbc084e0a0e$var$sharedCanvas[\"transferControlToOffscreen\"]) return (0, $191e7775e3189472$export$6806abd6abc725de)(img instanceof ImageBitmap ? img : await createImageBitmap(img), transfer);\n    $aa7f0fbc084e0a0e$var$sharedCanvas.width = img.width, $aa7f0fbc084e0a0e$var$sharedCanvas.height = img.height;\n    $aa7f0fbc084e0a0e$var$sharedCtx.drawImage(img, 0, 0);\n    return $aa7f0fbc084e0a0e$var$sharedCtx.getImageData(0, 0, img.width, img.height);\n};\nconst $aa7f0fbc084e0a0e$export$24422be91ad4011f = (file, name)=>{\n    const url = URL.createObjectURL(file);\n    const el = document.createElement(\"a\");\n    el.download = name;\n    el.href = url;\n    el.click();\n    URL.revokeObjectURL(url);\n};\n\n\nvar $0cb1959d223972af$exports = {};\n$0cb1959d223972af$exports = import.meta.resolve(\"bj76Q\");\n\n\nvar $9443c4fd1da700d5$exports = {};\n$9443c4fd1da700d5$exports = import.meta.resolve(\"e0Dy9\");\n\n\nvar $be823d6b5d4da9b0$exports = {};\n$be823d6b5d4da9b0$exports = import.meta.resolve(\"lX2gi\");\n\n\nvar $c608ccace1148cde$exports = {};\n$c608ccace1148cde$exports = import.meta.resolve(\"gltHY\");\n\n\n/**\n * MediaStream ImageCapture polyfill\n *\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */ let $0e4bd8b916ae6e46$export$d2caa7debd66c3ef = window.ImageCapture;\nif (typeof $0e4bd8b916ae6e46$export$d2caa7debd66c3ef === 'undefined') $0e4bd8b916ae6e46$export$d2caa7debd66c3ef = class {\n    /**\n     * TODO https://www.w3.org/TR/image-capture/#constructors\n     *\n     * @param {MediaStreamTrack} videoStreamTrack - A MediaStreamTrack of the 'video' kind\n     */ constructor(videoStreamTrack){\n        if (videoStreamTrack.kind !== 'video') throw new DOMException('NotSupportedError');\n        this._videoStreamTrack = videoStreamTrack;\n        if (!('readyState' in this._videoStreamTrack)) // Polyfill for Firefox\n        this._videoStreamTrack.readyState = 'live';\n        // MediaStream constructor not available until Chrome 55 - https://www.chromestatus.com/feature/5912172546752512\n        this._previewStream = new MediaStream([\n            videoStreamTrack\n        ]);\n        this.videoElement = document.createElement('video');\n        this.videoElementPlaying = new Promise((resolve)=>{\n            this.videoElement.addEventListener('playing', resolve);\n        });\n        if (HTMLMediaElement) this.videoElement.srcObject = this._previewStream; // Safari 11 doesn't allow use of createObjectURL for MediaStream\n        else this.videoElement.src = URL.createObjectURL(this._previewStream);\n        this.videoElement.muted = true;\n        this.videoElement.setAttribute('playsinline', ''); // Required by Safari on iOS 11. See https://webkit.org/blog/6784\n        this.videoElement.play();\n        this.canvasElement = document.createElement('canvas');\n        // TODO Firefox has https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas\n        this.canvas2dContext = this.canvasElement.getContext('2d');\n    }\n    /**\n     * https://w3c.github.io/mediacapture-image/index.html#dom-imagecapture-videostreamtrack\n     * @return {MediaStreamTrack} The MediaStreamTrack passed into the constructor\n     */ get videoStreamTrack() {\n        return this._videoStreamTrack;\n    }\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-getphotocapabilities\n     * @return {Promise<PhotoCapabilities>} Fulfilled promise with\n     * [PhotoCapabilities](https://www.w3.org/TR/image-capture/#idl-def-photocapabilities)\n     * object on success, rejected promise on failure\n     */ getPhotoCapabilities() {\n        return new Promise(function executorGPC(resolve, reject) {\n            // TODO see https://github.com/w3c/mediacapture-image/issues/97\n            const MediaSettingsRange = {\n                current: 0,\n                min: 0,\n                max: 0\n            };\n            resolve({\n                exposureCompensation: MediaSettingsRange,\n                exposureMode: 'none',\n                fillLightMode: 'none',\n                focusMode: 'none',\n                imageHeight: MediaSettingsRange,\n                imageWidth: MediaSettingsRange,\n                iso: MediaSettingsRange,\n                redEyeReduction: false,\n                whiteBalanceMode: 'none',\n                zoom: MediaSettingsRange\n            });\n            reject(new DOMException('OperationError'));\n        });\n    }\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-setoptions\n     * @param {Object} photoSettings - Photo settings dictionary, https://www.w3.org/TR/image-capture/#idl-def-photosettings\n     * @return {Promise<void>} Fulfilled promise on success, rejected promise on failure\n     */ setOptions(photoSettings = {}) {\n        return new Promise(function executorSO(resolve, reject) {\n        // TODO\n        });\n    }\n    /**\n     * TODO\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-takephoto\n     * @return {Promise<Blob>} Fulfilled promise with [Blob](https://www.w3.org/TR/FileAPI/#blob)\n     * argument on success; rejected promise on failure\n     */ takePhoto() {\n        const self = this;\n        return new Promise(function executorTP(resolve, reject) {\n            // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n            // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n            if (self._videoStreamTrack.readyState !== 'live') return reject(new DOMException('InvalidStateError'));\n            self.videoElementPlaying.then(()=>{\n                try {\n                    self.canvasElement.width = self.videoElement.videoWidth;\n                    self.canvasElement.height = self.videoElement.videoHeight;\n                    self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n                    self.canvasElement.toBlob(resolve);\n                } catch (error) {\n                    reject(new DOMException('UnknownError'));\n                }\n            });\n        });\n    }\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-grabframe\n     * @return {Promise<ImageBitmap>} Fulfilled promise with\n     * [ImageBitmap](https://www.w3.org/TR/html51/webappapis.html#webappapis-images)\n     * argument on success; rejected promise on failure\n     */ grabFrame() {\n        const self = this;\n        return new Promise(function executorGF(resolve, reject) {\n            // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n            // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n            if (self._videoStreamTrack.readyState !== 'live') return reject(new DOMException('InvalidStateError'));\n            self.videoElementPlaying.then(()=>{\n                try {\n                    self.canvasElement.width = self.videoElement.videoWidth;\n                    self.canvasElement.height = self.videoElement.videoHeight;\n                    self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n                    // TODO polyfill https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmapFactories/createImageBitmap for IE\n                    resolve(window.createImageBitmap(self.canvasElement));\n                } catch (error) {\n                    reject(new DOMException('UnknownError'));\n                }\n            });\n        });\n    }\n};\nwindow.ImageCapture = $0e4bd8b916ae6e46$export$d2caa7debd66c3ef;\n\n\nconst $b4e14b6b8da86996$var$root = document.getElementById(\"root\");\nconst $b4e14b6b8da86996$var$modal = document.getElementById(\"modal\");\nconst $b4e14b6b8da86996$var$captures = document.getElementById(\"captures\");\nconst $b4e14b6b8da86996$var$preview = document.getElementById(\"preview\");\nconst $b4e14b6b8da86996$var$previewCrop = document.getElementById(\"preview-crop\");\nconst $b4e14b6b8da86996$var$previewDoc = document.getElementById(\"preview-doc\");\nconst $b4e14b6b8da86996$var$bottomWrapper = document.getElementById(\"bottom-wrapper\");\nconst $b4e14b6b8da86996$var$topWrapper = document.getElementById(\"top-wrapper\");\nconst $b4e14b6b8da86996$var$selectWrapper = document.getElementById(\"camera-select-wrapper\");\nconst $b4e14b6b8da86996$var$select = document.getElementById(\"camera-select\");\nconst $b4e14b6b8da86996$var$qualityWrapper = document.getElementById(\"quality-wrapper\");\nconst $b4e14b6b8da86996$var$quality = document.getElementById(\"quality\");\nconst $b4e14b6b8da86996$var$qualityImg = document.getElementById(\"quality-img\");\nconst $b4e14b6b8da86996$var$githubWrapper = document.getElementById(\"github-wrapper\");\nconst $b4e14b6b8da86996$var$flashWrapper = document.getElementById(\"flash-wrapper\");\nconst $b4e14b6b8da86996$var$flash = document.getElementById(\"flash\");\nconst $b4e14b6b8da86996$var$flashImg = document.getElementById(\"flash-img\");\nconst $b4e14b6b8da86996$var$pastWrapper = document.getElementById(\"past-wrapper\");\nconst $b4e14b6b8da86996$var$past = document.getElementById(\"past\");\nconst $b4e14b6b8da86996$var$uploadWrapper = document.getElementById(\"upload-wrapper\");\nconst $b4e14b6b8da86996$var$upload = document.getElementById(\"upload\");\nconst $b4e14b6b8da86996$var$shutter = document.getElementById(\"shutter\");\nconst $b4e14b6b8da86996$var$doneWrapper = document.getElementById(\"done-wrapper\");\nconst $b4e14b6b8da86996$var$done = document.getElementById(\"done\");\nconst $b4e14b6b8da86996$var$modalBottomWrapper = document.getElementById(\"modal-bottom-wrapper\");\nconst $b4e14b6b8da86996$var$modalCancelWrapper = document.getElementById(\"modal-cancel-wrapper\");\nconst $b4e14b6b8da86996$var$modalCancel = document.getElementById(\"modal-cancel\");\nconst $b4e14b6b8da86996$var$modalDoneWrapper = document.getElementById(\"modal-done-wrapper\");\nconst $b4e14b6b8da86996$var$modalDone = document.getElementById(\"modal-done\");\nlet $b4e14b6b8da86996$var$defaultMaxRes;\nlet $b4e14b6b8da86996$var$maxRes = {};\nconst $b4e14b6b8da86996$var$pages = [];\nconst $b4e14b6b8da86996$var$log = (text)=>{\n    const el = document.createElement(\"div\");\n    el.innerText = text;\n    $b4e14b6b8da86996$var$root.appendChild(el);\n};\nconst $b4e14b6b8da86996$var$resizeListeners = [];\nconst $b4e14b6b8da86996$var$onResize = (listener)=>{\n    $b4e14b6b8da86996$var$resizeListeners.push(listener);\n    return ()=>{\n        $b4e14b6b8da86996$var$resizeListeners.splice($b4e14b6b8da86996$var$resizeListeners.indexOf(listener), 1);\n    };\n};\nconst $b4e14b6b8da86996$var$callResizeListeners = ()=>{\n    for (const listener of $b4e14b6b8da86996$var$resizeListeners)listener();\n};\nlet $b4e14b6b8da86996$var$rst = -1;\nwindow.addEventListener(\"resize\", ()=>{\n    clearTimeout($b4e14b6b8da86996$var$rst);\n    $b4e14b6b8da86996$var$rst = setTimeout($b4e14b6b8da86996$var$callResizeListeners, 250);\n}, {\n    passive: true\n});\nconst $b4e14b6b8da86996$var$getMaxRes = (device)=>{\n    const constraints = {\n        width: 100000,\n        height: 100000,\n        facingMode: \"environment\"\n    };\n    if (device) {\n        if ($b4e14b6b8da86996$var$maxRes[device]) return $b4e14b6b8da86996$var$maxRes[device];\n        constraints.deviceId = {\n            exact: device\n        };\n    } else if ($b4e14b6b8da86996$var$defaultMaxRes) return $b4e14b6b8da86996$var$defaultMaxRes;\n    const prom = navigator.mediaDevices.getUserMedia({\n        video: constraints\n    }).then((media)=>{\n        const settings = media.getVideoTracks()[0].getSettings();\n        for (const track of media.getTracks())track.stop();\n        const width = Math.max(settings.width, settings.height);\n        const height = Math.min(settings.width, settings.height);\n        return {\n            width: width,\n            height: height,\n            deviceId: settings.deviceId\n        };\n    });\n    if (device) $b4e14b6b8da86996$var$maxRes[device] = prom;\n    else $b4e14b6b8da86996$var$defaultMaxRes = prom.then((val)=>{\n        $b4e14b6b8da86996$var$maxRes[val.deviceId] = prom;\n        return val;\n    });\n    return prom;\n};\nconst $b4e14b6b8da86996$var$point = (a, scale)=>{\n    const elem = document.createElement(\"div\");\n    const mwh = Math.min(window.innerWidth, window.innerHeight);\n    elem.style.width = mwh * 0.03 + \"px\";\n    elem.style.height = mwh * 0.03 + \"px\";\n    elem.style.borderRadius = mwh * 0.015 + \"px\";\n    elem.style.backgroundColor = \"black\";\n    elem.style.position = \"absolute\";\n    $b4e14b6b8da86996$var$adjustPoint(elem, a, scale);\n    return elem;\n};\nconst $b4e14b6b8da86996$var$adjustPoint = (elem, a, scale)=>{\n    const mwh = Math.min(window.innerWidth, window.innerHeight);\n    elem.style.top = a.y * scale - mwh * 0.015 + \"px\";\n    elem.style.left = a.x * scale - mwh * 0.015 + \"px\";\n};\nconst $b4e14b6b8da86996$var$line = (a, b, scale)=>{\n    const elem = document.createElement(\"div\");\n    elem.style.height = \"4px\";\n    elem.style.backgroundColor = \"red\";\n    elem.style.position = \"absolute\";\n    elem.style.transformOrigin = \"center left\";\n    $b4e14b6b8da86996$var$adjustLine(elem, a, b, scale);\n    return elem;\n};\nconst $b4e14b6b8da86996$var$adjustLine = (elem, a, b, scale)=>{\n    elem.style.width = Math.hypot(a.x - b.x, a.y - b.y) * scale + \"px\";\n    elem.style.top = a.y * scale + \"px\";\n    elem.style.left = a.x * scale + \"px\";\n    elem.style.transform = `rotate(${Math.atan2(b.y - a.y, b.x - a.x)}rad)`;\n};\nconst $b4e14b6b8da86996$var$preprocessPhoto = async (src)=>{\n    let img, data;\n    if (src instanceof Blob) {\n        const image = await (0, $aa7f0fbc084e0a0e$export$85ada9a21afbeab6)(src);\n        img = image;\n        data = await (0, $aa7f0fbc084e0a0e$export$7a171f172be0782e)(image);\n    } else {\n        const cnv = document.createElement(\"canvas\");\n        cnv.width = src.width;\n        cnv.height = src.height;\n        cnv.getContext(\"2d\").drawImage(src, 0, 0);\n        img = cnv;\n        data = await (0, $aa7f0fbc084e0a0e$export$7a171f172be0782e)(src, true);\n    }\n    const quad = await (0, $191e7775e3189472$export$c5fefc891e91de4b)(data) || {\n        a: {\n            x: 0,\n            y: data.height\n        },\n        b: {\n            x: 0,\n            y: 0\n        },\n        c: {\n            x: data.width,\n            y: 0\n        },\n        d: {\n            x: data.width,\n            y: data.height\n        }\n    };\n    const clampPoint = (a)=>{\n        if (a.x < 0) a.x = 0;\n        else if (a.x > data.width) a.x = data.width;\n        if (a.y < 0) a.y = 0;\n        else if (a.y > data.height) a.y = data.height;\n    };\n    clampPoint(quad.a);\n    clampPoint(quad.b);\n    clampPoint(quad.c);\n    clampPoint(quad.d);\n    return {\n        img: img,\n        data: data,\n        quad: quad\n    };\n};\nconst $b4e14b6b8da86996$var$processPhotos = async (srcs)=>{\n    // Throttle: process images sequentially to avoid overwhelming resources\n    const total = srcs.length;\n    const cbs = [];\n    let firstDimensions = {\n        width: 0,\n        height: 0\n    };\n    let landscape = false;\n    for(let idx = 0; idx < total; idx++){\n        const src = srcs[idx];\n        const { img: img, data: data, quad: quad } = src instanceof Blob || src instanceof ImageBitmap ? await $b4e14b6b8da86996$var$preprocessPhoto(src) : src;\n        const imgCrop = document.createElement(\"div\");\n        imgCrop.style.display = \"flex\";\n        imgCrop.style.justifyContent = \"center\";\n        imgCrop.style.alignItems = \"center\";\n        imgCrop.style.overflow = \"hidden\";\n        imgCrop.style.scrollSnapAlign = \"center\";\n        const imgDoc = document.createElement(\"div\");\n        imgDoc.style.position = \"relative\";\n        imgDoc.appendChild(img);\n        imgCrop.appendChild(imgDoc);\n        $b4e14b6b8da86996$var$modal.style.display = \"flex\";\n        const aspectRatio = Math.max(data.width, data.height) / Math.min(data.width, data.height);\n        let scale = 0, docX = 0, docY = 0, latestDims = false;\n        let prevElems = [];\n        const getLatestDims = ()=>{\n            if (!latestDims) {\n                const { left: left, top: top } = imgDoc.getBoundingClientRect();\n                docX = left;\n                docY = top;\n                latestDims = true;\n            }\n        };\n        const makePoint = (src, onUpdate)=>{\n            const pt = $b4e14b6b8da86996$var$point(src, scale);\n            let active = false;\n            const onDown = (evt, x, y)=>{\n                if (pt.parentElement == imgDoc) {\n                    if (evt.target == pt || evt.target == img && Math.hypot(x - src.x * scale, y - src.y * scale) < Math.min(window.innerWidth, window.innerHeight) * 0.2) {\n                        evt.stopImmediatePropagation();\n                        active = true;\n                        onMove(x, y);\n                    }\n                } else {\n                    imgDoc.removeEventListener(\"mousedown\", onMouseDown);\n                    imgDoc.removeEventListener(\"touchstart\", onTouchStart);\n                    imgDoc.removeEventListener(\"mousemove\", onMouseMove);\n                    imgDoc.removeEventListener(\"touchmove\", onTouchMove);\n                    imgDoc.removeEventListener(\"mouseup\", onUp);\n                    imgDoc.removeEventListener(\"touchend\", onUp);\n                }\n            };\n            const onMove = (x, y)=>{\n                src.x = x / scale;\n                src.y = y / scale;\n                $b4e14b6b8da86996$var$adjustPoint(pt, src, scale);\n                onUpdate();\n            };\n            const onUp = ()=>{\n                active = false;\n            };\n            const onMouseDown = (e)=>{\n                getLatestDims();\n                onDown(e, e.pageX - docX, e.pageY - docY);\n            };\n            imgDoc.addEventListener(\"mousedown\", onMouseDown);\n            const onTouchStart = (e)=>{\n                const touch = e.targetTouches[0];\n                getLatestDims();\n                onDown(e, touch.pageX - docX, touch.pageY - docY);\n            };\n            imgDoc.addEventListener(\"touchstart\", onTouchStart);\n            const onMouseMove = (e)=>{\n                if (active) {\n                    e.preventDefault();\n                    onMove(e.pageX - docX, e.pageY - docY);\n                }\n            };\n            imgDoc.addEventListener(\"mousemove\", onMouseMove);\n            const onTouchMove = (e)=>{\n                if (active) {\n                    const touch = e.targetTouches[0];\n                    e.preventDefault();\n                    onMove(touch.pageX - docX, touch.pageY - docY);\n                }\n            };\n            imgDoc.addEventListener(\"touchmove\", onTouchMove);\n            imgDoc.addEventListener(\"mouseup\", onUp);\n            imgDoc.addEventListener(\"touchend\", onUp);\n            return pt;\n        };\n        const paintLines = ()=>{\n            for (const elem of prevElems)imgDoc.removeChild(elem);\n            const ab = $b4e14b6b8da86996$var$line(quad.a, quad.b, scale);\n            const bc = $b4e14b6b8da86996$var$line(quad.b, quad.c, scale);\n            const cd = $b4e14b6b8da86996$var$line(quad.c, quad.d, scale);\n            const da = $b4e14b6b8da86996$var$line(quad.d, quad.a, scale);\n            prevElems = [\n                imgDoc.appendChild(ab),\n                imgDoc.appendChild(bc),\n                imgDoc.appendChild(cd),\n                imgDoc.appendChild(da),\n                imgDoc.appendChild(makePoint(quad.a, ()=>{\n                    $b4e14b6b8da86996$var$adjustLine(da, quad.d, quad.a, scale);\n                    $b4e14b6b8da86996$var$adjustLine(ab, quad.a, quad.b, scale);\n                })),\n                imgDoc.appendChild(makePoint(quad.b, ()=>{\n                    $b4e14b6b8da86996$var$adjustLine(ab, quad.a, quad.b, scale);\n                    $b4e14b6b8da86996$var$adjustLine(bc, quad.b, quad.c, scale);\n                })),\n                imgDoc.appendChild(makePoint(quad.c, ()=>{\n                    $b4e14b6b8da86996$var$adjustLine(bc, quad.b, quad.c, scale);\n                    $b4e14b6b8da86996$var$adjustLine(cd, quad.c, quad.d, scale);\n                })),\n                imgDoc.appendChild(makePoint(quad.d, ()=>{\n                    $b4e14b6b8da86996$var$adjustLine(cd, quad.c, quad.d, scale);\n                    $b4e14b6b8da86996$var$adjustLine(da, quad.d, quad.a, scale);\n                }))\n            ];\n        };\n        const updateImageDimensions = ()=>{\n            const { width: width, height: height } = idx === 0 ? $b4e14b6b8da86996$var$calcDimensions(aspectRatio, 0.925) : firstDimensions;\n            if (idx === 0) {\n                landscape = $b4e14b6b8da86996$var$isLandscape(aspectRatio);\n                firstDimensions = {\n                    width: width,\n                    height: height\n                };\n                $b4e14b6b8da86996$var$modalCancelWrapper.style.width = $b4e14b6b8da86996$var$modalCancelWrapper.style.height = $b4e14b6b8da86996$var$modalDoneWrapper.style.width = $b4e14b6b8da86996$var$modalDoneWrapper.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.035 + \"px\";\n                $b4e14b6b8da86996$var$modalCancelWrapper.style.margin = $b4e14b6b8da86996$var$modalDoneWrapper.style.margin = (landscape ? window.innerWidth : window.innerHeight) * 0.02 + \"px\";\n                $b4e14b6b8da86996$var$captures.style.width = $b4e14b6b8da86996$var$modal.style.width = window.innerWidth + \"px\";\n                $b4e14b6b8da86996$var$captures.style.height = $b4e14b6b8da86996$var$modal.style.height = window.innerHeight + \"px\";\n                $b4e14b6b8da86996$var$modal.style.flexDirection = landscape ? \"row\" : \"column\";\n                $b4e14b6b8da86996$var$captures.style.flexDirection = landscape ? \"column\" : \"row\";\n                if (landscape) {\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.flexDirection = \"column\";\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.height = window.innerHeight + \"px\";\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.width = \"\";\n                } else {\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.flexDirection = \"row\";\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.height = \"\";\n                    $b4e14b6b8da86996$var$modalBottomWrapper.style.width = window.innerWidth + \"px\";\n                }\n            }\n            const cssWidth = width + \"px\";\n            const cssHeight = height + \"px\";\n            if (landscape) {\n                img.style.width = \"\";\n                img.style.height = cssHeight;\n                scale = window.innerHeight / data.height;\n            } else {\n                img.style.width = cssWidth;\n                img.style.height = \"\";\n                scale = window.innerWidth / data.width;\n            }\n            imgCrop.style.width = imgCrop.style.minWidth = cssWidth;\n            imgCrop.style.height = imgCrop.style.minHeight = cssHeight;\n            latestDims = false;\n            paintLines();\n        };\n        updateImageDimensions();\n        $b4e14b6b8da86996$var$captures.appendChild(imgCrop);\n        const offResize = $b4e14b6b8da86996$var$onResize(updateImageDimensions);\n        cbs.push((check)=>{\n            if (check) {\n                $b4e14b6b8da86996$var$pages.push({\n                    data: data,\n                    quad: quad,\n                    img: img\n                });\n                $b4e14b6b8da86996$var$doneWrapper.style.opacity = \"\";\n                if (idx === total - 1) {\n                    if (img.width > img.height) {\n                        img.style.height = $b4e14b6b8da86996$var$pastWrapper.style.height;\n                        img.style.width = \"\";\n                    } else {\n                        img.style.height = \"\";\n                        img.style.width = $b4e14b6b8da86996$var$pastWrapper.style.width;\n                    }\n                    while($b4e14b6b8da86996$var$pastWrapper.lastChild != $b4e14b6b8da86996$var$past)$b4e14b6b8da86996$var$pastWrapper.removeChild($b4e14b6b8da86996$var$pastWrapper.lastChild);\n                    $b4e14b6b8da86996$var$pastWrapper.appendChild(img);\n                }\n            }\n            offResize();\n            $b4e14b6b8da86996$var$captures.removeChild(imgCrop);\n        });\n    }\n    return new Promise((resolve)=>{\n        const onDone = ()=>finish(true);\n        const onCancel = ()=>finish(false);\n        $b4e14b6b8da86996$var$modalCancel.addEventListener(\"click\", onCancel);\n        $b4e14b6b8da86996$var$modalDone.addEventListener(\"click\", onDone);\n        const finish = (check)=>{\n            $b4e14b6b8da86996$var$modalDone.removeEventListener(\"click\", onDone);\n            $b4e14b6b8da86996$var$modalCancel.removeEventListener(\"click\", onCancel);\n            $b4e14b6b8da86996$var$modal.style.display = \"none\";\n            for (const cb of cbs)cb(check);\n            resolve(check);\n        };\n    });\n};\nconst $b4e14b6b8da86996$var$isLandscape = (aspectRatio)=>window.innerWidth > window.innerHeight * aspectRatio;\nconst $b4e14b6b8da86996$var$calcDimensions = (aspectRatio, maxRatio)=>{\n    const landscape = $b4e14b6b8da86996$var$isLandscape(aspectRatio);\n    const height = landscape ? window.innerHeight : Math.floor(Math.min(window.innerWidth * aspectRatio, window.innerHeight * maxRatio));\n    const width = landscape ? Math.floor(Math.min(window.innerHeight * aspectRatio, window.innerWidth * maxRatio)) : window.innerWidth;\n    return {\n        width: width,\n        height: height\n    };\n};\nconst $b4e14b6b8da86996$var$sideWrappers = [\n    $b4e14b6b8da86996$var$topWrapper,\n    $b4e14b6b8da86996$var$bottomWrapper\n];\nconst $b4e14b6b8da86996$var$topElems = [\n    $b4e14b6b8da86996$var$flashWrapper,\n    $b4e14b6b8da86996$var$qualityWrapper,\n    $b4e14b6b8da86996$var$githubWrapper,\n    $b4e14b6b8da86996$var$selectWrapper,\n    $b4e14b6b8da86996$var$pastWrapper\n];\nconst $b4e14b6b8da86996$var$bottomElems = [\n    $b4e14b6b8da86996$var$doneWrapper,\n    $b4e14b6b8da86996$var$uploadWrapper\n];\nconst $b4e14b6b8da86996$var$allElems = $b4e14b6b8da86996$var$topElems.concat($b4e14b6b8da86996$var$bottomElems, $b4e14b6b8da86996$var$shutter);\nconst $b4e14b6b8da86996$var$startStream = async (device)=>{\n    const maxRes = await $b4e14b6b8da86996$var$getMaxRes(device);\n    let aspectRatio = maxRes.width / maxRes.height;\n    const landscape = $b4e14b6b8da86996$var$isLandscape(aspectRatio);\n    const { width: width, height: height } = $b4e14b6b8da86996$var$calcDimensions(aspectRatio, 0.84);\n    const cssHeight = height + \"px\";\n    const cssWidth = width + \"px\";\n    $b4e14b6b8da86996$var$previewCrop.style.width = $b4e14b6b8da86996$var$previewCrop.style.minWidth = cssWidth;\n    $b4e14b6b8da86996$var$previewCrop.style.height = $b4e14b6b8da86996$var$previewCrop.style.minHeight = cssHeight;\n    $b4e14b6b8da86996$var$root.style.width = window.innerWidth + \"px\";\n    $b4e14b6b8da86996$var$root.style.height = window.innerHeight + \"px\";\n    for (const sideWrapper of $b4e14b6b8da86996$var$sideWrappers)if (landscape) {\n        sideWrapper.style.flexDirection = \"column\";\n        sideWrapper.style.height = window.innerHeight + \"px\";\n        sideWrapper.style.width = \"\";\n    } else {\n        sideWrapper.style.flexDirection = \"row\";\n        sideWrapper.style.height = \"\";\n        sideWrapper.style.width = window.innerWidth + \"px\";\n    }\n    for (const topElem of $b4e14b6b8da86996$var$topElems)topElem.style.width = topElem.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.03 + \"px\";\n    for (const bottomElem of $b4e14b6b8da86996$var$bottomElems)bottomElem.style.width = bottomElem.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.035 + \"px\";\n    for (const elem of $b4e14b6b8da86996$var$allElems)elem.style.margin = (landscape ? window.innerWidth : window.innerHeight) * 0.02 + \"px\";\n    $b4e14b6b8da86996$var$shutter.style.width = $b4e14b6b8da86996$var$shutter.style.height = (landscape ? window.innerWidth : window.innerHeight) * 0.05 + \"px\";\n    const pastBorderSize = (landscape ? window.innerWidth : window.innerHeight) * 0.002 + \"px\";\n    $b4e14b6b8da86996$var$pastWrapper.style.borderRadius = pastBorderSize;\n    $b4e14b6b8da86996$var$pastWrapper.style.border = pastBorderSize + \" solid white\";\n    if (landscape) {\n        $b4e14b6b8da86996$var$preview.style.height = cssHeight;\n        $b4e14b6b8da86996$var$preview.style.width = \"\";\n        $b4e14b6b8da86996$var$root.style.flexDirection = \"row\";\n    } else {\n        $b4e14b6b8da86996$var$preview.style.height = \"\";\n        $b4e14b6b8da86996$var$preview.style.width = cssWidth;\n        $b4e14b6b8da86996$var$root.style.flexDirection = \"column\";\n    }\n    const constraints = {\n        width: maxRes.width,\n        height: maxRes.height,\n        deviceId: {\n            exact: maxRes.deviceId\n        }\n    };\n    const stream = await navigator.mediaDevices.getUserMedia({\n        video: constraints\n    });\n    const videoTrack = stream.getVideoTracks()[0];\n    const capabilities = videoTrack.getCapabilities();\n    $b4e14b6b8da86996$var$flashWrapper.style.display = capabilities.torch ? \"\" : \"none\";\n    $b4e14b6b8da86996$var$preview.srcObject = stream;\n    let newElems = [];\n    const clearNewElems = ()=>{\n        for (const elem of newElems)$b4e14b6b8da86996$var$previewDoc.removeChild(elem);\n        newElems.length = 0;\n    };\n    const onMetadata = ()=>{\n        const scale = landscape ? window.innerHeight / $b4e14b6b8da86996$var$preview.videoHeight : window.innerWidth / $b4e14b6b8da86996$var$preview.videoWidth;\n        const docPreview = async ()=>{\n            let quad;\n            const ts = performance.now();\n            if ($b4e14b6b8da86996$var$modal.style.display == \"none\") quad = await (0, $191e7775e3189472$export$c5fefc891e91de4b)(await (0, $aa7f0fbc084e0a0e$export$7a171f172be0782e)(await cap.grabFrame()), true);\n            clearNewElems();\n            if (docPreviewTimeout != -1) {\n                if (quad) newElems = [\n                    $b4e14b6b8da86996$var$previewDoc.appendChild($b4e14b6b8da86996$var$line(quad.a, quad.b, scale)),\n                    $b4e14b6b8da86996$var$previewDoc.appendChild($b4e14b6b8da86996$var$line(quad.b, quad.c, scale)),\n                    $b4e14b6b8da86996$var$previewDoc.appendChild($b4e14b6b8da86996$var$line(quad.c, quad.d, scale)),\n                    $b4e14b6b8da86996$var$previewDoc.appendChild($b4e14b6b8da86996$var$line(quad.d, quad.a, scale))\n                ];\n                docPreviewTimeout = setTimeout(docPreview, Math.max(250 - performance.now() + ts, 0));\n            }\n        };\n        docPreviewTimeout = setTimeout(docPreview, 0);\n    };\n    $b4e14b6b8da86996$var$preview.addEventListener(\"loadedmetadata\", onMetadata);\n    const cap = new ImageCapture(videoTrack);\n    let hd = Object.prototype.toString.call(cap) == \"[object ImageCapture]\";\n    $b4e14b6b8da86996$var$qualityWrapper.style.display = hd ? \"\" : \"none\";\n    $b4e14b6b8da86996$var$qualityImg.src = (0, (/*@__PURE__*/$parcel$interopDefault($be823d6b5d4da9b0$exports)));\n    const onQualityClick = ()=>{\n        hd = !hd;\n        $b4e14b6b8da86996$var$qualityImg.src = hd ? (0, (/*@__PURE__*/$parcel$interopDefault($be823d6b5d4da9b0$exports))) : (0, (/*@__PURE__*/$parcel$interopDefault($c608ccace1148cde$exports)));\n    };\n    $b4e14b6b8da86996$var$quality.addEventListener(\"click\", onQualityClick);\n    let docPreviewTimeout = -1;\n    const shutterFlash = ()=>{\n        $b4e14b6b8da86996$var$preview.style.opacity = \"0\";\n        setTimeout(()=>$b4e14b6b8da86996$var$preview.style.opacity = \"\", 50);\n    };\n    const onShutterClick = async ()=>{\n        if ($b4e14b6b8da86996$var$shutter.style.opacity == \"\") {\n            $b4e14b6b8da86996$var$shutter.style.opacity = \"0.5\";\n            shutterFlash();\n            try {\n                let photo = hd ? await cap.takePhoto() : await cap.grabFrame();\n                photo = await $b4e14b6b8da86996$var$compressImage(photo);\n                await $b4e14b6b8da86996$var$processPhotos([\n                    photo\n                ]);\n            } catch (e) {}\n            $b4e14b6b8da86996$var$shutter.style.opacity = \"\";\n        }\n    };\n    $b4e14b6b8da86996$var$shutter.addEventListener(\"click\", onShutterClick);\n    let torch = false;\n    $b4e14b6b8da86996$var$flashImg.src = (0, (/*@__PURE__*/$parcel$interopDefault($9443c4fd1da700d5$exports)));\n    const onFlashClick = async ()=>{\n        try {\n            torch = !torch;\n            await videoTrack.applyConstraints({\n                advanced: [\n                    {\n                        torch: torch\n                    }\n                ]\n            });\n            $b4e14b6b8da86996$var$flashImg.src = torch ? (0, (/*@__PURE__*/$parcel$interopDefault($0cb1959d223972af$exports))) : (0, (/*@__PURE__*/$parcel$interopDefault($9443c4fd1da700d5$exports)));\n        } catch (e) {}\n    };\n    $b4e14b6b8da86996$var$flash.addEventListener(\"click\", onFlashClick);\n    return {\n        deviceId: maxRes.deviceId,\n        close () {\n            clearTimeout(docPreviewTimeout);\n            docPreviewTimeout = -1;\n            $b4e14b6b8da86996$var$shutter.removeEventListener(\"click\", onShutterClick);\n            $b4e14b6b8da86996$var$flash.removeEventListener(\"click\", onFlashClick);\n            $b4e14b6b8da86996$var$quality.removeEventListener(\"click\", onQualityClick);\n            $b4e14b6b8da86996$var$preview.removeEventListener(\"loadedmetadata\", onMetadata);\n            $b4e14b6b8da86996$var$preview.pause();\n            for (const track of stream.getTracks())track.stop();\n        }\n    };\n};\n// Add compressImage helper to scale down and encode images as JPEG\nasync function $b4e14b6b8da86996$var$compressImage(src, maxDim = 1024, quality = 0.8) {\n    let bitmap;\n    if (src instanceof Blob) bitmap = await createImageBitmap(src);\n    else bitmap = src;\n    const ratio = Math.min(1, maxDim / bitmap.width, maxDim / bitmap.height);\n    const width = Math.round(bitmap.width * ratio);\n    const height = Math.round(bitmap.height * ratio);\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.drawImage(bitmap, 0, 0, width, height);\n    return await new Promise((resolve, reject)=>{\n        canvas.toBlob((blob)=>{\n            if (blob) resolve(blob);\n            else reject(new Error(\"Compression failed\"));\n        }, \"image/jpeg\", quality);\n    });\n}\nvar $38245ec463101f6a$exports = {};\n\nlet $38245ec463101f6a$var$url = new URL(import.meta.resolve(\"2E4nm\"));\n$38245ec463101f6a$exports = $56b621a6dd25b2cb$exports($38245ec463101f6a$var$url.toString(), $38245ec463101f6a$var$url.origin, true);\n\n\nconst $b4e14b6b8da86996$var$onLoad = async ()=>{\n    let stream = await $b4e14b6b8da86996$var$startStream(localStorage.getItem(\"defaultDevice\"));\n    const updateBold = ()=>{\n        for (const option of $b4e14b6b8da86996$var$select.options)option.style.fontWeight = \"\";\n        $b4e14b6b8da86996$var$select.selectedOptions[0].style.fontWeight = \"bold\";\n    };\n    for (const device of (await navigator.mediaDevices.enumerateDevices()))if (device.kind == \"videoinput\") {\n        const option = document.createElement(\"option\");\n        option.value = device.deviceId;\n        option.label = device.label;\n        $b4e14b6b8da86996$var$select.appendChild(option);\n    }\n    $b4e14b6b8da86996$var$select.value = stream.deviceId;\n    updateBold();\n    const update = async ()=>{\n        updateBold();\n        stream.close();\n        $b4e14b6b8da86996$var$select.disabled = true;\n        localStorage.setItem(\"defaultDevice\", $b4e14b6b8da86996$var$select.value);\n        stream = await $b4e14b6b8da86996$var$startStream($b4e14b6b8da86996$var$select.value);\n        $b4e14b6b8da86996$var$select.disabled = false;\n    };\n    $b4e14b6b8da86996$var$select.onchange = update;\n    $b4e14b6b8da86996$var$upload.onchange = async ()=>{\n        $b4e14b6b8da86996$var$shutter.style.opacity = \"0.5\";\n        const files = [\n            ...$b4e14b6b8da86996$var$upload.files\n        ];\n        try {\n            for (const file of files){\n                const compressed = await $b4e14b6b8da86996$var$compressImage(file);\n                await $b4e14b6b8da86996$var$processPhotos([\n                    compressed\n                ]);\n            }\n        } catch (err) {\n            console.error(\"Error processing uploaded files\", err);\n            alert(\"Error processing uploaded images: \" + err.message);\n        } finally{\n            $b4e14b6b8da86996$var$shutter.style.opacity = \"\";\n            $b4e14b6b8da86996$var$upload.value = \"\"; // clear selection to free memory\n        }\n    };\n    $b4e14b6b8da86996$var$done.onclick = async ()=>{\n        if (!$b4e14b6b8da86996$var$pages.length) return;\n        $b4e14b6b8da86996$var$doneWrapper.style.opacity = \"0.5\";\n        try {\n            while($b4e14b6b8da86996$var$pastWrapper.lastChild != $b4e14b6b8da86996$var$past)$b4e14b6b8da86996$var$pastWrapper.removeChild($b4e14b6b8da86996$var$pastWrapper.lastChild);\n            // Generate PDF from the extracted images\n            const extracted = await Promise.all($b4e14b6b8da86996$var$pages.map(({ data: data, quad: quad })=>(0, $191e7775e3189472$export$ab8ba24d4c0c8986)(data, quad, 1224, true)));\n            let pdfData;\n            // Attempt to offload PDF creation to a worker if not Safari and OffscreenCanvas.convertToBlob is supported\n            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n            if (!isSafari && typeof OffscreenCanvas !== \"undefined\" && typeof new OffscreenCanvas(1, 1).convertToBlob === \"function\") {\n                const worker = new Worker($38245ec463101f6a$exports);\n                // Transfer pixel buffers for efficiency and cloneability\n                const transferList = extracted.map(({ data: data })=>data.buffer);\n                pdfData = await new Promise((res, rej)=>{\n                    worker.onmessage = (evt)=>{\n                        const msg = evt.data;\n                        if (msg.error) rej(new Error(msg.error));\n                        else res(msg);\n                    };\n                    worker.onerror = (err)=>rej(err);\n                    worker.postMessage(extracted, transferList);\n                });\n                worker.terminate();\n            } else // Fallback: generate PDF on main thread\n            pdfData = await (0, $98ce8732f7dffb75$export$99fdcdff3bb1ad24)(extracted);\n            const pdfBlob = new Blob([\n                pdfData\n            ], {\n                type: \"application/pdf\"\n            });\n            window.parent.postMessage({\n                type: \"scannedPDF\",\n                blob: pdfBlob\n            }, \"*\");\n            $b4e14b6b8da86996$var$pages.length = 0;\n        } catch (err) {\n            console.error(\"Error generating PDF\", err);\n            alert(\"Failed to generate PDF: \" + err.message);\n        } finally{\n            $b4e14b6b8da86996$var$doneWrapper.style.opacity = \"\";\n        }\n    };\n    $b4e14b6b8da86996$var$past.onclick = async ()=>{\n        if (!$b4e14b6b8da86996$var$pages.length) return;\n        const currPages = $b4e14b6b8da86996$var$pages.slice();\n        $b4e14b6b8da86996$var$pages.length = 0;\n        let ok = false;\n        try {\n            ok = await $b4e14b6b8da86996$var$processPhotos(currPages);\n        } catch (err) {\n            console.error(\"Error re-processing pages\", err);\n            alert(\"Error re-processing pages: \" + err.message);\n        }\n        if (!ok) {\n            $b4e14b6b8da86996$var$pages.push(...currPages);\n            const { img: img } = currPages[currPages.length - 1];\n            if (img.width > img.height) {\n                img.style.height = $b4e14b6b8da86996$var$pastWrapper.style.height;\n                img.style.width = \"\";\n            } else {\n                img.style.height = \"\";\n                img.style.width = $b4e14b6b8da86996$var$pastWrapper.style.width;\n            }\n            while($b4e14b6b8da86996$var$pastWrapper.lastChild != $b4e14b6b8da86996$var$past)$b4e14b6b8da86996$var$pastWrapper.removeChild($b4e14b6b8da86996$var$pastWrapper.lastChild);\n            $b4e14b6b8da86996$var$pastWrapper.appendChild(img);\n        }\n    };\n};\n$b4e14b6b8da86996$var$onLoad();\nvar $777da7615efb492e$exports = {};\n$777da7615efb492e$exports = import.meta.resolve(\"drXuR\");\n\n\nnavigator.serviceWorker.register($777da7615efb492e$exports);\n\n\n//# sourceMappingURL=scanner.95ddfe9b.js.map\n","import { findDocument, extractDocument, Point, Quad } from \"./process\";\nimport { toPDF } from \"./pdf\";\nimport { toImage, getData, download } from \"./io\";\nimport { ProspectivePage, getFile, setFile } from \"./db\";\nimport flashURL from \"url:./flash.svg\";\nimport flashOffURL from \"url:./flash-off.svg\";\nimport hdURL from \"url:./hd.svg\";\nimport sdURL from \"url:./sd.svg\";\nimport \"image-capture\";\n\nconst root = document.getElementById(\"root\") as HTMLDivElement;\nconst modal = document.getElementById(\"modal\") as HTMLDivElement;\nconst captures = document.getElementById(\"captures\") as HTMLDivElement;\nconst preview = document.getElementById(\"preview\") as HTMLVideoElement;\nconst previewCrop = document.getElementById(\"preview-crop\") as HTMLDivElement;\nconst previewDoc = document.getElementById(\"preview-doc\") as HTMLDivElement;\nconst bottomWrapper = document.getElementById(\n  \"bottom-wrapper\"\n) as HTMLDivElement;\nconst topWrapper = document.getElementById(\"top-wrapper\") as HTMLDivElement;\nconst selectWrapper = document.getElementById(\n  \"camera-select-wrapper\"\n) as HTMLDivElement;\nconst select = document.getElementById(\"camera-select\") as HTMLSelectElement;\nconst qualityWrapper = document.getElementById(\n  \"quality-wrapper\"\n) as HTMLDivElement;\nconst quality = document.getElementById(\"quality\") as HTMLButtonElement;\nconst qualityImg = document.getElementById(\"quality-img\") as HTMLImageElement;\nconst githubWrapper = document.getElementById(\n  \"github-wrapper\"\n) as HTMLDivElement;\nconst flashWrapper = document.getElementById(\"flash-wrapper\") as HTMLDivElement;\nconst flash = document.getElementById(\"flash\") as HTMLButtonElement;\nconst flashImg = document.getElementById(\"flash-img\") as HTMLImageElement;\nconst pastWrapper = document.getElementById(\"past-wrapper\") as HTMLDivElement;\nconst past = document.getElementById(\"past\") as HTMLDivElement;\nconst uploadWrapper = document.getElementById(\n  \"upload-wrapper\"\n) as HTMLDivElement;\nconst upload = document.getElementById(\"upload\") as HTMLInputElement;\nconst shutter = document.getElementById(\"shutter\") as HTMLImageElement;\nconst doneWrapper = document.getElementById(\"done-wrapper\") as HTMLDivElement;\nconst done = document.getElementById(\"done\") as HTMLButtonElement;\nconst modalBottomWrapper = document.getElementById(\n  \"modal-bottom-wrapper\"\n) as HTMLDivElement;\nconst modalCancelWrapper = document.getElementById(\n  \"modal-cancel-wrapper\"\n) as HTMLDivElement;\nconst modalCancel = document.getElementById(\n  \"modal-cancel\"\n) as HTMLButtonElement;\nconst modalDoneWrapper = document.getElementById(\n  \"modal-done-wrapper\"\n) as HTMLDivElement;\nconst modalDone = document.getElementById(\"modal-done\") as HTMLButtonElement;\ntype Dimensions = {\n  width: number;\n  height: number;\n};\n\ntype MaxRes = Dimensions & {\n  deviceId: string;\n};\n\nlet defaultMaxRes: Promise<MaxRes>;\nlet maxRes: Record<string, Promise<MaxRes> | undefined> = {};\n\ntype Page = ProspectivePage & {\n  img: HTMLImageElement | HTMLCanvasElement;\n};\n\nconst pages: Page[] = [];\n\nconst log = (text: string) => {\n  const el = document.createElement(\"div\");\n  el.innerText = text;\n  root.appendChild(el);\n};\n\nconst resizeListeners: (() => void)[] = [];\n\nconst onResize = (listener: () => void) => {\n  resizeListeners.push(listener);\n  return () => {\n    resizeListeners.splice(resizeListeners.indexOf(listener), 1);\n  };\n};\n\nconst callResizeListeners = () => {\n  for (const listener of resizeListeners) {\n    listener();\n  }\n};\n\nlet rst = -1;\nwindow.addEventListener(\n  \"resize\",\n  () => {\n    clearTimeout(rst);\n    rst = setTimeout(callResizeListeners, 250) as unknown as number;\n  },\n  { passive: true }\n);\n\nconst getMaxRes = (device?: string) => {\n  const constraints: MediaTrackConstraints = {\n    width: 100000,\n    height: 100000,\n    facingMode: \"environment\",\n  };\n  if (device) {\n    if (maxRes[device]) return maxRes[device]!;\n    constraints.deviceId = { exact: device };\n  } else if (defaultMaxRes) {\n    return defaultMaxRes;\n  }\n  const prom = navigator.mediaDevices\n    .getUserMedia({\n      video: constraints,\n    })\n    .then((media) => {\n      const settings = media.getVideoTracks()[0].getSettings();\n      for (const track of media.getTracks()) {\n        track.stop();\n      }\n      const width = Math.max(settings.width!, settings.height!);\n      const height = Math.min(settings.width!, settings.height!);\n      return { width, height, deviceId: settings.deviceId! };\n    });\n  if (device) maxRes[device] = prom;\n  else\n    defaultMaxRes = prom.then((val) => {\n      maxRes[val.deviceId] = prom;\n      return val;\n    });\n  return prom;\n};\n\nconst point = (a: Point, scale: number) => {\n  const elem = document.createElement(\"div\");\n  const mwh = Math.min(window.innerWidth, window.innerHeight);\n  elem.style.width = mwh * 0.03 + \"px\";\n  elem.style.height = mwh * 0.03 + \"px\";\n  elem.style.borderRadius = mwh * 0.015 + \"px\";\n  elem.style.backgroundColor = \"black\";\n  elem.style.position = \"absolute\";\n  adjustPoint(elem, a, scale);\n  return elem;\n};\n\nconst adjustPoint = (elem: HTMLDivElement, a: Point, scale: number) => {\n  const mwh = Math.min(window.innerWidth, window.innerHeight);\n  elem.style.top = a.y * scale - mwh * 0.015 + \"px\";\n  elem.style.left = a.x * scale - mwh * 0.015 + \"px\";\n};\n\nconst line = (a: Point, b: Point, scale: number) => {\n  const elem = document.createElement(\"div\");\n  elem.style.height = \"4px\";\n  elem.style.backgroundColor = \"red\";\n  elem.style.position = \"absolute\";\n  elem.style.transformOrigin = \"center left\";\n  adjustLine(elem, a, b, scale);\n  return elem;\n};\n\nconst adjustLine = (\n  elem: HTMLDivElement,\n  a: Point,\n  b: Point,\n  scale: number\n) => {\n  elem.style.width = Math.hypot(a.x - b.x, a.y - b.y) * scale + \"px\";\n  elem.style.top = a.y * scale + \"px\";\n  elem.style.left = a.x * scale + \"px\";\n  elem.style.transform = `rotate(${Math.atan2(b.y - a.y, b.x - a.x)}rad)`;\n};\n\nconst preprocessPhoto = async (src: Blob | ImageBitmap) => {\n  let img: HTMLImageElement | HTMLCanvasElement, data: ImageData;\n  if (src instanceof Blob) {\n    const image = await toImage(src);\n    img = image;\n    data = await getData(image);\n  } else {\n    const cnv = document.createElement(\"canvas\");\n    cnv.width = src.width;\n    cnv.height = src.height;\n    cnv.getContext(\"2d\")!.drawImage(src, 0, 0);\n    img = cnv;\n    data = await getData(src, true);\n  }\n  const quad = (await findDocument(data)) || {\n    a: { x: 0, y: data.height },\n    b: { x: 0, y: 0 },\n    c: { x: data.width, y: 0 },\n    d: { x: data.width, y: data.height },\n  };\n  const clampPoint = (a: Point) => {\n    if (a.x < 0) a.x = 0;\n    else if (a.x > data.width) a.x = data.width;\n    if (a.y < 0) a.y = 0;\n    else if (a.y > data.height) a.y = data.height;\n  };\n  clampPoint(quad.a);\n  clampPoint(quad.b);\n  clampPoint(quad.c);\n  clampPoint(quad.d);\n  return { img, data, quad };\n};\n\nconst processPhotos = async (srcs: (Blob | ImageBitmap | Page)[]) => {\n  // Throttle: process images sequentially to avoid overwhelming resources\n  const total = srcs.length;\n  const cbs: ((check: boolean) => void)[] = [];\n  let firstDimensions = { width: 0, height: 0 };\n  let landscape = false;\n  for (let idx = 0; idx < total; idx++) {\n    const src = srcs[idx];\n    const { img, data, quad } =\n      src instanceof Blob || src instanceof ImageBitmap\n        ? await preprocessPhoto(src)\n        : src;\n    const imgCrop = document.createElement(\"div\");\n    imgCrop.style.display = \"flex\";\n    imgCrop.style.justifyContent = \"center\";\n    imgCrop.style.alignItems = \"center\";\n    imgCrop.style.overflow = \"hidden\";\n    imgCrop.style.scrollSnapAlign = \"center\";\n    const imgDoc = document.createElement(\"div\");\n    imgDoc.style.position = \"relative\";\n    imgDoc.appendChild(img);\n    imgCrop.appendChild(imgDoc);\n    modal.style.display = \"flex\";\n    const aspectRatio =\n      Math.max(data.width, data.height) / Math.min(data.width, data.height);\n    let scale = 0,\n      docX = 0,\n      docY = 0,\n      latestDims = false;\n    let prevElems: HTMLDivElement[] = [];\n    const getLatestDims = () => {\n      if (!latestDims) {\n        const { left, top } = imgDoc.getBoundingClientRect();\n        docX = left;\n        docY = top;\n        latestDims = true;\n      }\n    };\n    const makePoint = (src: Point, onUpdate: () => void) => {\n      const pt = point(src, scale);\n      let active = false;\n      const onDown = (evt: MouseEvent | TouchEvent, x: number, y: number) => {\n        if (pt.parentElement == imgDoc) {\n          if (\n            evt.target == pt ||\n            (evt.target == img &&\n              Math.hypot(x - src.x * scale, y - src.y * scale) <\n                Math.min(window.innerWidth, window.innerHeight) * 0.2)\n          ) {\n            evt.stopImmediatePropagation();\n            active = true;\n            onMove(x, y);\n          }\n        } else {\n          imgDoc.removeEventListener(\"mousedown\", onMouseDown);\n          imgDoc.removeEventListener(\"touchstart\", onTouchStart);\n          imgDoc.removeEventListener(\"mousemove\", onMouseMove);\n          imgDoc.removeEventListener(\"touchmove\", onTouchMove);\n          imgDoc.removeEventListener(\"mouseup\", onUp);\n          imgDoc.removeEventListener(\"touchend\", onUp);\n        }\n      };\n      const onMove = (x: number, y: number) => {\n        src.x = x / scale;\n        src.y = y / scale;\n        adjustPoint(pt, src, scale);\n        onUpdate();\n      };\n      const onUp = () => {\n        active = false;\n      };\n      const onMouseDown = (e: MouseEvent) => {\n        getLatestDims();\n        onDown(e, e.pageX - docX, e.pageY - docY);\n      };\n      imgDoc.addEventListener(\"mousedown\", onMouseDown);\n      const onTouchStart = (e: TouchEvent) => {\n        const touch = e.targetTouches[0];\n        getLatestDims();\n        onDown(e, touch.pageX - docX, touch.pageY - docY);\n      };\n      imgDoc.addEventListener(\"touchstart\", onTouchStart);\n      const onMouseMove = (e: MouseEvent) => {\n        if (active) {\n          e.preventDefault();\n          onMove(e.pageX - docX, e.pageY - docY);\n        }\n      };\n      imgDoc.addEventListener(\"mousemove\", onMouseMove);\n      const onTouchMove = (e: TouchEvent) => {\n        if (active) {\n          const touch = e.targetTouches[0];\n          e.preventDefault();\n          onMove(touch.pageX - docX, touch.pageY - docY);\n        }\n      };\n      imgDoc.addEventListener(\"touchmove\", onTouchMove);\n      imgDoc.addEventListener(\"mouseup\", onUp);\n      imgDoc.addEventListener(\"touchend\", onUp);\n      return pt;\n    };\n    const paintLines = () => {\n      for (const elem of prevElems) {\n        imgDoc.removeChild(elem);\n      }\n      const ab = line(quad.a, quad.b, scale);\n      const bc = line(quad.b, quad.c, scale);\n      const cd = line(quad.c, quad.d, scale);\n      const da = line(quad.d, quad.a, scale);\n      prevElems = [\n        imgDoc.appendChild(ab),\n        imgDoc.appendChild(bc),\n        imgDoc.appendChild(cd),\n        imgDoc.appendChild(da),\n        imgDoc.appendChild(\n          makePoint(quad.a, () => {\n            adjustLine(da, quad.d, quad.a, scale);\n            adjustLine(ab, quad.a, quad.b, scale);\n          })\n        ),\n        imgDoc.appendChild(\n          makePoint(quad.b, () => {\n            adjustLine(ab, quad.a, quad.b, scale);\n            adjustLine(bc, quad.b, quad.c, scale);\n          })\n        ),\n        imgDoc.appendChild(\n          makePoint(quad.c, () => {\n            adjustLine(bc, quad.b, quad.c, scale);\n            adjustLine(cd, quad.c, quad.d, scale);\n          })\n        ),\n        imgDoc.appendChild(\n          makePoint(quad.d, () => {\n            adjustLine(cd, quad.c, quad.d, scale);\n            adjustLine(da, quad.d, quad.a, scale);\n          })\n        ),\n      ];\n    };\n    const updateImageDimensions = () => {\n      const { width, height } =\n        idx === 0 ? calcDimensions(aspectRatio, 0.925) : firstDimensions;\n      if (idx === 0) {\n        landscape = isLandscape(aspectRatio);\n        firstDimensions = { width, height };\n        modalCancelWrapper.style.width =\n          modalCancelWrapper.style.height =\n          modalDoneWrapper.style.width =\n          modalDoneWrapper.style.height =\n            (landscape ? window.innerWidth : window.innerHeight) * 0.035 + \"px\";\n        modalCancelWrapper.style.margin = modalDoneWrapper.style.margin =\n          (landscape ? window.innerWidth : window.innerHeight) * 0.02 + \"px\";\n        captures.style.width = modal.style.width = window.innerWidth + \"px\";\n        captures.style.height = modal.style.height = window.innerHeight + \"px\";\n        modal.style.flexDirection = landscape ? \"row\" : \"column\";\n        captures.style.flexDirection = landscape ? \"column\" : \"row\";\n        if (landscape) {\n          modalBottomWrapper.style.flexDirection = \"column\";\n          modalBottomWrapper.style.height = window.innerHeight + \"px\";\n          modalBottomWrapper.style.width = \"\";\n        } else {\n          modalBottomWrapper.style.flexDirection = \"row\";\n          modalBottomWrapper.style.height = \"\";\n          modalBottomWrapper.style.width = window.innerWidth + \"px\";\n        }\n      }\n      const cssWidth = width + \"px\";\n      const cssHeight = height + \"px\";\n\n      if (landscape) {\n        img.style.width = \"\";\n        img.style.height = cssHeight;\n        scale = window.innerHeight / data.height;\n      } else {\n        img.style.width = cssWidth;\n        img.style.height = \"\";\n        scale = window.innerWidth / data.width;\n      }\n      imgCrop.style.width = imgCrop.style.minWidth = cssWidth;\n      imgCrop.style.height = imgCrop.style.minHeight = cssHeight;\n      latestDims = false;\n      paintLines();\n    };\n    updateImageDimensions();\n    captures.appendChild(imgCrop);\n    const offResize = onResize(updateImageDimensions);\n    cbs.push((check) => {\n      if (check) {\n        pages.push({ data, quad, img });\n        doneWrapper.style.opacity = \"\";\n        if (idx === total - 1) {\n          if (img.width > img.height) {\n            img.style.height = pastWrapper.style.height;\n            img.style.width = \"\";\n          } else {\n            img.style.height = \"\";\n            img.style.width = pastWrapper.style.width;\n          }\n          while (pastWrapper.lastChild != past) {\n            pastWrapper.removeChild(pastWrapper.lastChild!);\n          }\n          pastWrapper.appendChild(img);\n        }\n      }\n      offResize();\n      captures.removeChild(imgCrop);\n    });\n  }\n\n  return new Promise((resolve) => {\n    const onDone = () => finish(true);\n    const onCancel = () => finish(false);\n    modalCancel.addEventListener(\"click\", onCancel);\n    modalDone.addEventListener(\"click\", onDone);\n    const finish = (check: boolean) => {\n      modalDone.removeEventListener(\"click\", onDone);\n      modalCancel.removeEventListener(\"click\", onCancel);\n      modal.style.display = \"none\";\n      for (const cb of cbs) {\n        cb(check);\n      }\n      resolve(check);\n    };\n  });\n};\n\nconst isLandscape = (aspectRatio: number) =>\n  window.innerWidth > window.innerHeight * aspectRatio;\n\nconst calcDimensions = (aspectRatio: number, maxRatio: number) => {\n  const landscape = isLandscape(aspectRatio);\n  const height = landscape\n    ? window.innerHeight\n    : Math.floor(\n        Math.min(window.innerWidth * aspectRatio, window.innerHeight * maxRatio)\n      );\n  const width = landscape\n    ? Math.floor(\n        Math.min(window.innerHeight * aspectRatio, window.innerWidth * maxRatio)\n      )\n    : window.innerWidth;\n  return { width, height };\n};\n\nconst sideWrappers = [topWrapper, bottomWrapper];\nconst topElems = [\n  flashWrapper,\n  qualityWrapper,\n  githubWrapper,\n  selectWrapper,\n  pastWrapper,\n];\nconst bottomElems = [doneWrapper, uploadWrapper];\nconst allElems = topElems.concat(bottomElems, shutter);\n\nconst startStream = async (device?: string) => {\n  const maxRes = await getMaxRes(device);\n  let aspectRatio = maxRes.width / maxRes.height;\n  const landscape = isLandscape(aspectRatio);\n  const { width, height } = calcDimensions(aspectRatio, 0.84);\n  const cssHeight = height + \"px\";\n  const cssWidth = width + \"px\";\n  previewCrop.style.width = previewCrop.style.minWidth = cssWidth;\n  previewCrop.style.height = previewCrop.style.minHeight = cssHeight;\n  root.style.width = window.innerWidth + \"px\";\n  root.style.height = window.innerHeight + \"px\";\n  for (const sideWrapper of sideWrappers) {\n    if (landscape) {\n      sideWrapper.style.flexDirection = \"column\";\n      sideWrapper.style.height = window.innerHeight + \"px\";\n      sideWrapper.style.width = \"\";\n    } else {\n      sideWrapper.style.flexDirection = \"row\";\n      sideWrapper.style.height = \"\";\n      sideWrapper.style.width = window.innerWidth + \"px\";\n    }\n  }\n  for (const topElem of topElems) {\n    topElem.style.width = topElem.style.height =\n      (landscape ? window.innerWidth : window.innerHeight) * 0.03 + \"px\";\n  }\n  for (const bottomElem of bottomElems) {\n    bottomElem.style.width = bottomElem.style.height =\n      (landscape ? window.innerWidth : window.innerHeight) * 0.035 + \"px\";\n  }\n  for (const elem of allElems) {\n    elem.style.margin =\n      (landscape ? window.innerWidth : window.innerHeight) * 0.02 + \"px\";\n  }\n  shutter.style.width = shutter.style.height =\n    (landscape ? window.innerWidth : window.innerHeight) * 0.05 + \"px\";\n  const pastBorderSize =\n    (landscape ? window.innerWidth : window.innerHeight) * 0.002 + \"px\";\n  pastWrapper.style.borderRadius = pastBorderSize;\n  pastWrapper.style.border = pastBorderSize + \" solid white\";\n  if (landscape) {\n    preview.style.height = cssHeight;\n    preview.style.width = \"\";\n    root.style.flexDirection = \"row\";\n  } else {\n    preview.style.height = \"\";\n    preview.style.width = cssWidth;\n    root.style.flexDirection = \"column\";\n  }\n  const constraints: MediaTrackConstraints = {\n    width: maxRes.width,\n    height: maxRes.height,\n    deviceId: { exact: maxRes.deviceId },\n  };\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: constraints,\n  });\n  const videoTrack = stream.getVideoTracks()[0];\n  const capabilities = videoTrack.getCapabilities();\n  flashWrapper.style.display = capabilities.torch ? \"\" : \"none\";\n  preview.srcObject = stream;\n  let newElems: Node[] = [];\n  const clearNewElems = () => {\n    for (const elem of newElems) {\n      previewDoc.removeChild(elem);\n    }\n    newElems.length = 0;\n  };\n  const onMetadata = () => {\n    const scale = landscape\n      ? window.innerHeight / preview.videoHeight\n      : window.innerWidth / preview.videoWidth;\n    const docPreview = async () => {\n      let quad: Quad | undefined;\n      const ts = performance.now();\n      if (modal.style.display == \"none\") {\n        quad = await findDocument(await getData(await cap.grabFrame()), true);\n      }\n      clearNewElems();\n      if (docPreviewTimeout != -1) {\n        if (quad) {\n          newElems = [\n            previewDoc.appendChild(line(quad.a, quad.b, scale)),\n            previewDoc.appendChild(line(quad.b, quad.c, scale)),\n            previewDoc.appendChild(line(quad.c, quad.d, scale)),\n            previewDoc.appendChild(line(quad.d, quad.a, scale)),\n          ];\n        }\n        docPreviewTimeout = setTimeout(\n          docPreview,\n          Math.max(250 - performance.now() + ts, 0)\n        ) as unknown as number;\n      }\n    };\n    docPreviewTimeout = setTimeout(docPreview, 0) as unknown as number;\n  };\n  preview.addEventListener(\"loadedmetadata\", onMetadata);\n  const cap = new ImageCapture(videoTrack);\n  let hd = Object.prototype.toString.call(cap) == \"[object ImageCapture]\";\n  qualityWrapper.style.display = hd ? \"\" : \"none\";\n  qualityImg.src = hdURL;\n  const onQualityClick = () => {\n    hd = !hd;\n    qualityImg.src = hd ? hdURL : sdURL;\n  };\n  quality.addEventListener(\"click\", onQualityClick);\n  let docPreviewTimeout = -1;\n  const shutterFlash = () => {\n    preview.style.opacity = \"0\";\n    setTimeout(() => (preview.style.opacity = \"\"), 50);\n  };\n  const onShutterClick = async () => {\n    if (shutter.style.opacity == \"\") {\n      shutter.style.opacity = \"0.5\";\n      shutterFlash();\n      try {\n        let photo = hd ? await cap.takePhoto() : await cap.grabFrame();\n        photo = await compressImage(photo);\n        await processPhotos([photo]);\n      } catch (e) {}\n      shutter.style.opacity = \"\";\n    }\n  };\n  shutter.addEventListener(\"click\", onShutterClick);\n  let torch = false;\n  flashImg.src = flashOffURL;\n  const onFlashClick = async () => {\n    try {\n      torch = !torch;\n      await videoTrack.applyConstraints({\n        advanced: [{ torch }],\n      });\n      flashImg.src = torch ? flashURL : flashOffURL;\n    } catch (e) {}\n  };\n  flash.addEventListener(\"click\", onFlashClick);\n  return {\n    deviceId: maxRes.deviceId,\n    close() {\n      clearTimeout(docPreviewTimeout);\n      docPreviewTimeout = -1;\n      shutter.removeEventListener(\"click\", onShutterClick);\n      flash.removeEventListener(\"click\", onFlashClick);\n      quality.removeEventListener(\"click\", onQualityClick);\n      preview.removeEventListener(\"loadedmetadata\", onMetadata);\n      preview.pause();\n      for (const track of stream.getTracks()) {\n        track.stop();\n      }\n    },\n  };\n};\n\n// Add compressImage helper to scale down and encode images as JPEG\nasync function compressImage(\n  src: Blob | ImageBitmap,\n  maxDim = 1024,\n  quality = 0.8\n): Promise<Blob> {\n  let bitmap: ImageBitmap;\n  if (src instanceof Blob) {\n    bitmap = await createImageBitmap(src);\n  } else {\n    bitmap = src;\n  }\n  const ratio = Math.min(1, maxDim / bitmap.width, maxDim / bitmap.height);\n  const width = Math.round(bitmap.width * ratio);\n  const height = Math.round(bitmap.height * ratio);\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext(\"2d\")!;\n  ctx.drawImage(bitmap, 0, 0, width, height);\n  return await new Promise<Blob>((resolve, reject) => {\n    canvas.toBlob(\n      (blob) => {\n        if (blob) resolve(blob);\n        else reject(new Error(\"Compression failed\"));\n      },\n      \"image/jpeg\",\n      quality\n    );\n  });\n}\n\nconst onLoad = async () => {\n  let stream = await startStream(localStorage.getItem(\"defaultDevice\")!);\n  const updateBold = () => {\n    for (const option of select.options) {\n      option.style.fontWeight = \"\";\n    }\n    select.selectedOptions[0].style.fontWeight = \"bold\";\n  };\n  for (const device of await navigator.mediaDevices.enumerateDevices()) {\n    if (device.kind == \"videoinput\") {\n      const option = document.createElement(\"option\");\n      option.value = device.deviceId;\n      option.label = device.label;\n      select.appendChild(option);\n    }\n  }\n  select.value = stream.deviceId;\n  updateBold();\n  const update = async () => {\n    updateBold();\n    stream.close();\n    select.disabled = true;\n    localStorage.setItem(\"defaultDevice\", select.value);\n    stream = await startStream(select.value);\n    select.disabled = false;\n  };\n  select.onchange = update;\n  upload.onchange = async () => {\n    shutter.style.opacity = \"0.5\";\n    const files = [...upload.files!];\n    try {\n      for (const file of files) {\n        const compressed = await compressImage(file);\n        await processPhotos([compressed]);\n      }\n    } catch (err) {\n      console.error(\"Error processing uploaded files\", err);\n      alert(\"Error processing uploaded images: \" + (err as Error).message);\n    } finally {\n      shutter.style.opacity = \"\";\n      upload.value = \"\"; // clear selection to free memory\n    }\n  };\n  done.onclick = async () => {\n    if (!pages.length) return;\n    doneWrapper.style.opacity = \"0.5\";\n    try {\n      while (pastWrapper.lastChild != past) {\n        pastWrapper.removeChild(pastWrapper.lastChild!);\n      }\n      // Generate PDF from the extracted images\n      const extracted = await Promise.all(\n        pages.map(({ data, quad }) => extractDocument(data, quad, 1224, true))\n      );\n      let pdfData: ArrayBuffer | Uint8Array;\n      // Attempt to offload PDF creation to a worker if not Safari and OffscreenCanvas.convertToBlob is supported\n      const isSafari = /^((?!chrome|android).)*safari/i.test(\n        navigator.userAgent\n      );\n      if (\n        !isSafari &&\n        typeof OffscreenCanvas !== \"undefined\" &&\n        typeof new OffscreenCanvas(1, 1).convertToBlob === \"function\"\n      ) {\n        const worker = new Worker(\n          new URL(\"./workers/pdfWorker.ts\", import.meta.url),\n          { type: \"module\" }\n        );\n        // Transfer pixel buffers for efficiency and cloneability\n        const transferList = extracted.map(({ data }) => data.buffer);\n        pdfData = await new Promise<ArrayBuffer>((res, rej) => {\n          worker.onmessage = (evt) => {\n            const msg = evt.data as any;\n            if (msg.error) rej(new Error(msg.error));\n            else res(msg as ArrayBuffer);\n          };\n          worker.onerror = (err) => rej(err);\n          worker.postMessage(extracted, transferList);\n        });\n        worker.terminate();\n      } else {\n        // Fallback: generate PDF on main thread\n        pdfData = await toPDF(extracted);\n      }\n      const pdfBlob = new Blob([pdfData], { type: \"application/pdf\" });\n      window.parent.postMessage({ type: \"scannedPDF\", blob: pdfBlob }, \"*\");\n      pages.length = 0;\n    } catch (err) {\n      console.error(\"Error generating PDF\", err);\n      alert(\"Failed to generate PDF: \" + (err as Error).message);\n    } finally {\n      doneWrapper.style.opacity = \"\";\n    }\n  };\n  past.onclick = async () => {\n    if (!pages.length) return;\n    const currPages = pages.slice();\n    pages.length = 0;\n    let ok: boolean = false;\n    try {\n      ok = (await processPhotos(currPages)) as boolean;\n    } catch (err) {\n      console.error(\"Error re-processing pages\", err);\n      alert(\"Error re-processing pages: \" + (err as Error).message);\n    }\n    if (!ok) {\n      pages.push(...currPages);\n      const { img } = currPages[currPages.length - 1];\n      if (img.width > img.height) {\n        img.style.height = pastWrapper.style.height;\n        img.style.width = \"\";\n      } else {\n        img.style.height = \"\";\n        img.style.width = pastWrapper.style.width;\n      }\n      while (pastWrapper.lastChild != past) {\n        pastWrapper.removeChild(pastWrapper.lastChild!);\n      }\n      pastWrapper.appendChild(img);\n    }\n  };\n};\n\nonLoad();\n\nif (process.env.NODE_ENV == \"production\") {\n  navigator.serviceWorker.register(\n    new URL(\"./workers/service.ts\", import.meta.url),\n    { type: \"module\" }\n  );\n}\n","import type { Message, Messages, Quad, Point } from \"./workers/ipc\";\n\nconst newWorker = () =>\n  new Worker(new URL(\"./workers/process.ts\", import.meta.url), {\n    type: \"module\",\n  });\n\nconst processWorkers: Worker[] = [];\n\nif (navigator.hardwareConcurrency) {\n  for (let i = 1; i < navigator.hardwareConcurrency; ++i) {\n    processWorkers.push(newWorker());\n  }\n}\n\nconst getWorker = () => processWorkers.pop() || newWorker();\nconst returnWorker = (worker: Worker) => processWorkers.push(worker);\n\nlet messageID = 0;\n\nconst message = async <T extends Message>(\n  msg: T,\n  transfer?: Transferable[]\n) => {\n  return new Promise<Messages[T[\"type\"]][1]>((resolve, reject) => {\n    const worker = getWorker();\n    let id = messageID++;\n    // const ts = performance.now();\n    const onMessage = (evt: MessageEvent) => {\n      const { id: mid, error, result } = evt.data;\n      if (mid == id) {\n        if (error) {\n          let err = new Error(error.message);\n          err.stack = error.stack;\n          err.name = error.name;\n          reject(err);\n        } else {\n          resolve(result);\n        }\n        // console.log('Processed', msg, 'in', (performance.now() - ts) + 'ms', { result, error });\n        returnWorker(worker);\n        worker.removeEventListener(\"message\", onMessage);\n      }\n    };\n    worker.addEventListener(\"message\", onMessage);\n    worker.postMessage({ id, msg }, transfer || []);\n  });\n};\n\nexport function findDocument(data: ImageData, transfer?: boolean) {\n  return message(\n    {\n      type: \"find-document\",\n      data,\n    },\n    transfer ? [data.data.buffer] : []\n  );\n}\n\nexport function extractDocument(\n  data: ImageData,\n  region: Quad,\n  targetWidth: number,\n  targetHeightOrTransfer?: number | boolean,\n  maybeTransfer?: boolean\n) {\n  // Determine if the 4th argument is a height or a transfer flag\n  let targetHeight: number | undefined;\n  let transfer: boolean;\n  if (typeof targetHeightOrTransfer === \"number\") {\n    targetHeight = targetHeightOrTransfer;\n    transfer = Boolean(maybeTransfer);\n  } else {\n    transfer = Boolean(targetHeightOrTransfer);\n  }\n  // Build the message payload\n  const payload: any = {\n    type: \"extract-document\",\n    data,\n    region,\n    targetWidth,\n  };\n  if (targetHeight !== undefined) {\n    payload.targetHeight = targetHeight;\n  }\n  return message(payload, transfer ? [data.data.buffer] : []);\n}\n\nexport function bitmapToData(bitmap: ImageBitmap, transfer?: boolean) {\n  return message(\n    {\n      type: \"get-data\",\n      bitmap,\n    },\n    transfer ? [bitmap] : []\n  );\n}\n\nexport { Quad, Point };\n","let workerURL = require('./helpers/get-worker-url');\nlet url = new URL(__parcel__import__.meta.resolve(\"a2Cve\"));\nmodule.exports = workerURL(url.toString(), url.origin, true);","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","/// <reference lib=\"dom\" />\n/// <reference lib=\"es2017\" />\n// In browser/worker, process may not exist; guard its usage\ndeclare const process: any;\n\nconst readFile =\n  Blob.prototype.arrayBuffer ||\n  function (this: Blob) {\n    return new Promise((resolve, reject) => {\n      const fr = new FileReader();\n      fr.onload = () => {\n        resolve(fr.result as ArrayBuffer);\n      };\n      fr.onerror = () => {\n        reject(fr.error);\n      };\n      fr.readAsArrayBuffer(this);\n    });\n  };\n\nexport const toPDF = async (images: ImageData[]) => {\n  const pdfChunks: (string | ArrayLike<number>)[] = [];\n  let index = 0;\n  const offsets: number[] = [];\n  const write = (chunk: string | ArrayLike<number>) => {\n    pdfChunks.push(chunk);\n    index += chunk.length;\n  };\n  const token = (chunk: string | ArrayLike<number>) => {\n    write(\" \");\n    write(chunk);\n  };\n  const concat = (chunks: (string | ArrayLike<number>)[]) => {\n    let len = 0;\n    for (const chunk of chunks) len += chunk.length;\n    const buf = new Uint8Array(len);\n    len = 0;\n    for (const chunk of chunks) {\n      if (typeof chunk == \"string\") {\n        for (let i = 0; i < chunk.length; ++i)\n          buf[i + len] = chunk.charCodeAt(i);\n      } else {\n        buf.set(chunk, len);\n      }\n      len += chunk.length;\n    }\n    return buf;\n  };\n  // Convenience functions\n  const comment = (content: string) => {\n    write(\"%\" + content + \"\\n\");\n  };\n  const number = (value: number) => {\n    // Note: this doesnt work for very small and very large numbers\n    token(value.toString());\n  };\n  const ascii = (value: string) => {\n    token(\n      \"(\" +\n        value.replace(\n          /[\\n\\r\\t\\f\\b\\(\\)\\\\]/g,\n          (c) => \"\\\\00\" + c.charCodeAt(0).toString(8)\n        ) +\n        \")\"\n    );\n  };\n  const bin = (value: string | ArrayLike<number>) => {\n    let data = \"<\";\n    if (typeof value == \"string\") {\n      for (let i = 0; i < value.length; ++i) {\n        data += value.charCodeAt(i).toString(16);\n      }\n    } else {\n      for (let i = 0; i < value.length; ++i) {\n        data += value[i].toString(16);\n      }\n    }\n    token(data + \">\");\n  };\n  const name = (value: string) => {\n    // Note: only supports ASCII names\n    token(\"/\" + value);\n  };\n  const array = (fn: () => void) => {\n    token(\"[\");\n    fn();\n    token(\"]\");\n  };\n  type Dict = Record<string, () => void>;\n  const dict = (values: Dict) => {\n    token(\"<<\");\n    for (const key in values) {\n      name(key);\n      values[key]();\n    }\n    token(\">>\");\n  };\n  const stream = (desc: Dict, content: ArrayLike<number>) => {\n    // Only assert in non-production when process.env is available\n    if (\n      typeof process !== \"undefined\" &&\n      process.env != null &&\n      process.env.NODE_ENV !== \"production\"\n    ) {\n      if (!desc[\"Length\"]) throw new TypeError(\"need stream length\");\n    }\n    dict(desc);\n    token(\"stream\\n\");\n    write(content);\n    write(\"endstream\");\n  };\n  const object = (fn: () => void) => {\n    write(\" \");\n    write(offsets.push(index) + \" 0 obj\");\n    fn();\n    token(\"endobj\");\n    return offsets.length;\n  };\n  const reference = (id: number) => {\n    token(id + \" 0 R\");\n  };\n  const nullObject = () => {\n    token(\"null\");\n  };\n\n  // v1.4 for compatibility\n  comment(\"PDF-1.4\");\n  // 4 byte binary comment, as suggested by spec\n  comment(\"\\x90\\x85\\xfa\\xe3\");\n  const pagesRootId = images.length * 3 + 1;\n  const pages = await Promise.all(\n    images.map(async (img) => {\n      // Convert ImageData to JPEG binary\n      let jpegBlob: Blob;\n      if (typeof OffscreenCanvas !== \"undefined\") {\n        const offscreen = new OffscreenCanvas(img.width, img.height);\n        const ctx = offscreen.getContext(\"2d\")!;\n        ctx.putImageData(img, 0, 0);\n        jpegBlob = await offscreen.convertToBlob({ type: \"image/jpeg\" });\n      } else if (typeof document !== \"undefined\") {\n        const htmlCanvas = document.createElement(\"canvas\");\n        htmlCanvas.width = img.width;\n        htmlCanvas.height = img.height;\n        const ctx = htmlCanvas.getContext(\"2d\")!;\n        ctx.putImageData(img, 0, 0);\n        jpegBlob = (await new Promise<Blob | null>((resolve) =>\n          htmlCanvas.toBlob(resolve, \"image/jpeg\")\n        ))!;\n      } else {\n        throw new Error(\n          \"Cannot generate JPEG: no canvas or document available in worker context\"\n        );\n      }\n      const jpegData = new Uint8Array(await readFile.call(jpegBlob));\n      const image = object(() => {\n        stream(\n          {\n            Type() {\n              name(\"XObject\");\n            },\n            Subtype() {\n              name(\"Image\");\n            },\n            Width() {\n              number(img.width);\n            },\n            Height() {\n              number(img.height);\n            },\n            ColorSpace() {\n              name(\"DeviceRGB\");\n            },\n            BitsPerComponent() {\n              number(8);\n            },\n            Filter() {\n              name(\"DCTDecode\");\n            },\n            Length() {\n              number(jpegData.length);\n            },\n          },\n          jpegData\n        );\n      });\n      // US Letter width\n      const height = 792;\n      const width = (height * img.width) / img.height;\n      const contents = object(() => {\n        const result = `${width} 0 0 ${height} 0 0 cm /I Do`;\n        stream(\n          {\n            Length() {\n              number(result.length);\n            },\n          },\n          concat([result])\n        );\n      });\n      const page = object(() => {\n        dict({\n          Type() {\n            name(\"Page\");\n          },\n          Parent() {\n            reference(pagesRootId);\n          },\n          Resources() {\n            dict({\n              XObject() {\n                dict({\n                  I() {\n                    reference(image);\n                  },\n                });\n              },\n            });\n          },\n          Contents() {\n            reference(contents);\n          },\n          MediaBox() {\n            array(() => {\n              number(0);\n              number(0);\n              number(width);\n              number(height);\n            });\n          },\n        });\n      });\n      return page;\n    })\n  );\n\n  const pageRoot = object(() => {\n    dict({\n      Type() {\n        name(\"Pages\");\n      },\n      Kids() {\n        array(() => {\n          for (const page of pages) {\n            reference(page);\n          }\n        });\n      },\n      Count() {\n        number(pages.length);\n      },\n    });\n  });\n\n  const catalog = object(() => {\n    dict({\n      Type() {\n        name(\"Catalog\");\n      },\n      Pages() {\n        reference(pageRoot);\n      },\n    });\n  });\n\n  // XREF\n  write(\"\\n\");\n  const xrefOffset = index;\n  write(\"xref\\n0 \" + (offsets.length + 1) + \"\\n0000000000 65535 f \\n\");\n  for (const offset of offsets) {\n    write(offset.toString().padStart(10, \"0\") + \" 00000 n \\n\");\n  }\n  write(\"trailer\");\n  dict({\n    Size() {\n      number(offsets.length + 1);\n    },\n    Root() {\n      reference(catalog);\n    },\n  });\n  write(\"\\nstartxref\\n\" + xrefOffset + \"\\n%%EOF\");\n  return concat(pdfChunks);\n};\n","import { bitmapToData } from \"./process\";\n\nexport const toImage = async (img: Blob) => {\n  const elem = document.createElement(\"img\");\n  const loaded = new Promise<void>((resolve, reject) => {\n    elem.onload = () => {\n      resolve();\n    };\n    elem.onerror = (err) => {\n      reject(err);\n    };\n  });\n  elem.src = URL.createObjectURL(img);\n  await loaded;\n  URL.revokeObjectURL(elem.src);\n  return elem;\n};\n\nconst sharedCanvas = document.createElement(\"canvas\");\nconst sharedCtx = sharedCanvas.getContext(\"2d\")!;\n\nexport const getData = async (\n  img: ImageBitmap | HTMLImageElement,\n  transfer?: boolean\n) => {\n  if (sharedCanvas[\"transferControlToOffscreen\" as \"getContext\"]) {\n    return bitmapToData(\n      img instanceof ImageBitmap ? img : await createImageBitmap(img),\n      transfer\n    );\n  }\n  (sharedCanvas.width = img.width), (sharedCanvas.height = img.height);\n  sharedCtx.drawImage(img, 0, 0);\n  return sharedCtx.getImageData(0, 0, img.width, img.height);\n};\n\nexport const download = (file: Blob, name: string) => {\n  const url = URL.createObjectURL(file);\n  const el = document.createElement(\"a\");\n  el.download = name;\n  el.href = url;\n  el.click();\n  URL.revokeObjectURL(url);\n};\n","module.exports = __parcel__import__.meta.resolve(\"bj76Q\");","module.exports = __parcel__import__.meta.resolve(\"e0Dy9\");","module.exports = __parcel__import__.meta.resolve(\"lX2gi\");","module.exports = __parcel__import__.meta.resolve(\"gltHY\");","/**\n * MediaStream ImageCapture polyfill\n *\n * @license\n * Copyright 2018 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport let ImageCapture = window.ImageCapture;\n\nif (typeof ImageCapture === 'undefined') {\n  ImageCapture = class {\n\n    /**\n     * TODO https://www.w3.org/TR/image-capture/#constructors\n     *\n     * @param {MediaStreamTrack} videoStreamTrack - A MediaStreamTrack of the 'video' kind\n     */\n    constructor(videoStreamTrack) {\n      if (videoStreamTrack.kind !== 'video')\n        throw new DOMException('NotSupportedError');\n\n      this._videoStreamTrack = videoStreamTrack;\n      if (!('readyState' in this._videoStreamTrack)) {\n        // Polyfill for Firefox\n        this._videoStreamTrack.readyState = 'live';\n      }\n\n      // MediaStream constructor not available until Chrome 55 - https://www.chromestatus.com/feature/5912172546752512\n      this._previewStream = new MediaStream([videoStreamTrack]);\n      this.videoElement = document.createElement('video');\n      this.videoElementPlaying = new Promise(resolve => {\n        this.videoElement.addEventListener('playing', resolve);\n      });\n      if (HTMLMediaElement) {\n        this.videoElement.srcObject = this._previewStream;  // Safari 11 doesn't allow use of createObjectURL for MediaStream\n      } else {\n        this.videoElement.src = URL.createObjectURL(this._previewStream);\n      }\n      this.videoElement.muted = true;\n      this.videoElement.setAttribute('playsinline', ''); // Required by Safari on iOS 11. See https://webkit.org/blog/6784\n      this.videoElement.play();\n\n      this.canvasElement = document.createElement('canvas');\n      // TODO Firefox has https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas\n      this.canvas2dContext = this.canvasElement.getContext('2d');\n    }\n\n    /**\n     * https://w3c.github.io/mediacapture-image/index.html#dom-imagecapture-videostreamtrack\n     * @return {MediaStreamTrack} The MediaStreamTrack passed into the constructor\n     */\n    get videoStreamTrack() {\n      return this._videoStreamTrack;\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-getphotocapabilities\n     * @return {Promise<PhotoCapabilities>} Fulfilled promise with\n     * [PhotoCapabilities](https://www.w3.org/TR/image-capture/#idl-def-photocapabilities)\n     * object on success, rejected promise on failure\n     */\n    getPhotoCapabilities() {\n      return new Promise(function executorGPC(resolve, reject) {\n        // TODO see https://github.com/w3c/mediacapture-image/issues/97\n        const MediaSettingsRange = {\n          current: 0, min: 0, max: 0,\n        };\n        resolve({\n          exposureCompensation: MediaSettingsRange,\n          exposureMode: 'none',\n          fillLightMode: 'none',\n          focusMode: 'none',\n          imageHeight: MediaSettingsRange,\n          imageWidth: MediaSettingsRange,\n          iso: MediaSettingsRange,\n          redEyeReduction: false,\n          whiteBalanceMode: 'none',\n          zoom: MediaSettingsRange,\n        });\n        reject(new DOMException('OperationError'));\n      });\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-setoptions\n     * @param {Object} photoSettings - Photo settings dictionary, https://www.w3.org/TR/image-capture/#idl-def-photosettings\n     * @return {Promise<void>} Fulfilled promise on success, rejected promise on failure\n     */\n    setOptions(photoSettings = {}) {\n      return new Promise(function executorSO(resolve, reject) {\n        // TODO\n      });\n    }\n\n    /**\n     * TODO\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-takephoto\n     * @return {Promise<Blob>} Fulfilled promise with [Blob](https://www.w3.org/TR/FileAPI/#blob)\n     * argument on success; rejected promise on failure\n     */\n    takePhoto() {\n      const self = this;\n      return new Promise(function executorTP(resolve, reject) {\n        // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n        // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n        if (self._videoStreamTrack.readyState !== 'live') {\n          return reject(new DOMException('InvalidStateError'));\n        }\n        self.videoElementPlaying.then(() => {\n          try {\n            self.canvasElement.width = self.videoElement.videoWidth;\n            self.canvasElement.height = self.videoElement.videoHeight;\n            self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n            self.canvasElement.toBlob(resolve);\n          } catch (error) {\n            reject(new DOMException('UnknownError'));\n          }\n        });\n      });\n    }\n\n    /**\n     * Implements https://www.w3.org/TR/image-capture/#dom-imagecapture-grabframe\n     * @return {Promise<ImageBitmap>} Fulfilled promise with\n     * [ImageBitmap](https://www.w3.org/TR/html51/webappapis.html#webappapis-images)\n     * argument on success; rejected promise on failure\n     */\n    grabFrame() {\n      const self = this;\n      return new Promise(function executorGF(resolve, reject) {\n        // `If the readyState of the MediaStreamTrack provided in the constructor is not live,\n        // return a promise rejected with a new DOMException whose name is \"InvalidStateError\".`\n        if (self._videoStreamTrack.readyState !== 'live') {\n          return reject(new DOMException('InvalidStateError'));\n        }\n        self.videoElementPlaying.then(() => {\n          try {\n            self.canvasElement.width = self.videoElement.videoWidth;\n            self.canvasElement.height = self.videoElement.videoHeight;\n            self.canvas2dContext.drawImage(self.videoElement, 0, 0);\n            // TODO polyfill https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmapFactories/createImageBitmap for IE\n            resolve(window.createImageBitmap(self.canvasElement));\n          } catch (error) {\n            reject(new DOMException('UnknownError'));\n          }\n        });\n      });\n    }\n  };\n}\n\nwindow.ImageCapture = ImageCapture;\n","let workerURL = require('./helpers/get-worker-url');\nlet url = new URL(__parcel__import__.meta.resolve(\"2E4nm\"));\nmodule.exports = workerURL(url.toString(), url.origin, true);","module.exports = __parcel__import__.meta.resolve(\"drXuR\");"],"names":["$b4e14b6b8da86996$var$defaultMaxRes","$parcel$interopDefault","a","__esModule","default","$4a0c81f9764a7da6$exports","$56b621a6dd25b2cb$exports","workerUrl","origin","isESM","self","location","source","JSON","stringify","URL","createObjectURL","Blob","type","$4a0c81f9764a7da6$var$url","resolve","toString","$191e7775e3189472$var$newWorker","Worker","$191e7775e3189472$var$processWorkers","navigator","hardwareConcurrency","i","push","$191e7775e3189472$var$getWorker","pop","$191e7775e3189472$var$returnWorker","worker","$191e7775e3189472$var$messageID","$191e7775e3189472$var$message","msg","transfer","Promise","reject","id","onMessage","evt","mid","error","result","data","err","Error","message","stack","name","removeEventListener","addEventListener","postMessage","$191e7775e3189472$export$c5fefc891e91de4b","buffer","$98ce8732f7dffb75$var$readFile","prototype","arrayBuffer","fr","FileReader","onload","onerror","readAsArrayBuffer","$98ce8732f7dffb75$export$99fdcdff3bb1ad24","images","pdfChunks","index","offsets","write","chunk","length","token","concat","chunks","len","buf","Uint8Array","charCodeAt","set","comment","content","number","value","array","fn","dict","values","key","stream","desc","process","env","NODE_ENV","TypeError","object","reference","pagesRootId","pages","all","map","img","jpegBlob","OffscreenCanvas","offscreen","width","height","ctx","getContext","putImageData","convertToBlob","document","htmlCanvas","createElement","toBlob","jpegData","call","image","Type","Subtype","Width","Height","ColorSpace","BitsPerComponent","Filter","Length","contents","Parent","Resources","XObject","I","Contents","MediaBox","pageRoot","Kids","page","Count","catalog","Pages","xrefOffset","offset","padStart","Size","Root","$aa7f0fbc084e0a0e$export$85ada9a21afbeab6","elem","loaded","src","revokeObjectURL","$aa7f0fbc084e0a0e$var$sharedCanvas","$aa7f0fbc084e0a0e$var$sharedCtx","$aa7f0fbc084e0a0e$export$7a171f172be0782e","bitmap","ImageBitmap","createImageBitmap","drawImage","getImageData","$0cb1959d223972af$exports","$9443c4fd1da700d5$exports","$be823d6b5d4da9b0$exports","$c608ccace1148cde$exports","$0e4bd8b916ae6e46$export$d2caa7debd66c3ef","window","ImageCapture","constructor","videoStreamTrack","kind","DOMException","_videoStreamTrack","readyState","_previewStream","MediaStream","videoElement","videoElementPlaying","HTMLMediaElement","srcObject","muted","setAttribute","play","canvasElement","canvas2dContext","getPhotoCapabilities","MediaSettingsRange","current","min","max","exposureCompensation","exposureMode","fillLightMode","focusMode","imageHeight","imageWidth","iso","redEyeReduction","whiteBalanceMode","zoom","setOptions","photoSettings","takePhoto","then","videoWidth","videoHeight","grabFrame","$b4e14b6b8da86996$var$root","getElementById","$b4e14b6b8da86996$var$modal","$b4e14b6b8da86996$var$captures","$b4e14b6b8da86996$var$preview","$b4e14b6b8da86996$var$previewCrop","$b4e14b6b8da86996$var$previewDoc","$b4e14b6b8da86996$var$bottomWrapper","$b4e14b6b8da86996$var$topWrapper","$b4e14b6b8da86996$var$selectWrapper","$b4e14b6b8da86996$var$select","$b4e14b6b8da86996$var$qualityWrapper","$b4e14b6b8da86996$var$quality","$b4e14b6b8da86996$var$qualityImg","$b4e14b6b8da86996$var$githubWrapper","$b4e14b6b8da86996$var$flashWrapper","$b4e14b6b8da86996$var$flash","$b4e14b6b8da86996$var$flashImg","$b4e14b6b8da86996$var$pastWrapper","$b4e14b6b8da86996$var$past","$b4e14b6b8da86996$var$uploadWrapper","$b4e14b6b8da86996$var$upload","$b4e14b6b8da86996$var$shutter","$b4e14b6b8da86996$var$doneWrapper","$b4e14b6b8da86996$var$done","$b4e14b6b8da86996$var$modalBottomWrapper","$b4e14b6b8da86996$var$modalCancelWrapper","$b4e14b6b8da86996$var$modalCancel","$b4e14b6b8da86996$var$modalDoneWrapper","$b4e14b6b8da86996$var$modalDone","$b4e14b6b8da86996$var$maxRes","$b4e14b6b8da86996$var$pages","$b4e14b6b8da86996$var$resizeListeners","$b4e14b6b8da86996$var$onResize","listener","splice","indexOf","$b4e14b6b8da86996$var$callResizeListeners","$b4e14b6b8da86996$var$rst","clearTimeout","setTimeout","passive","$b4e14b6b8da86996$var$getMaxRes","device","constraints","facingMode","deviceId","exact","prom","mediaDevices","getUserMedia","video","media","settings","getVideoTracks","getSettings","track","getTracks","stop","Math","val","$b4e14b6b8da86996$var$point","scale","mwh","innerWidth","innerHeight","style","borderRadius","backgroundColor","position","$b4e14b6b8da86996$var$adjustPoint","top","y","left","x","$b4e14b6b8da86996$var$line","b","transformOrigin","$b4e14b6b8da86996$var$adjustLine","hypot","transform","atan2","$b4e14b6b8da86996$var$preprocessPhoto","cnv","quad","c","d","clampPoint","$b4e14b6b8da86996$var$processPhotos","srcs","total","cbs","firstDimensions","landscape","idx","imgCrop","display","justifyContent","alignItems","overflow","scrollSnapAlign","imgDoc","appendChild","aspectRatio","docX","docY","latestDims","prevElems","getLatestDims","getBoundingClientRect","makePoint","onUpdate","pt","active","onDown","parentElement","target","stopImmediatePropagation","onMove","onMouseDown","onTouchStart","onMouseMove","onTouchMove","onUp","e","pageX","pageY","touch","targetTouches","preventDefault","paintLines","removeChild","ab","bc","cd","da","updateImageDimensions","$b4e14b6b8da86996$var$calcDimensions","$b4e14b6b8da86996$var$isLandscape","margin","flexDirection","cssWidth","cssHeight","minWidth","minHeight","offResize","check","opacity","lastChild","onDone","finish","onCancel","cb","maxRatio","floor","$b4e14b6b8da86996$var$sideWrappers","$b4e14b6b8da86996$var$topElems","$b4e14b6b8da86996$var$bottomElems","$b4e14b6b8da86996$var$allElems","$b4e14b6b8da86996$var$startStream","maxRes","sideWrapper","topElem","bottomElem","pastBorderSize","border","videoTrack","capabilities","getCapabilities","torch","newElems","clearNewElems","onMetadata","docPreview","ts","performance","now","cap","docPreviewTimeout","hd","Object","onQualityClick","shutterFlash","onShutterClick","photo","$b4e14b6b8da86996$var$compressImage","onFlashClick","applyConstraints","advanced","close","pause","maxDim","quality","ratio","round","canvas","blob","$38245ec463101f6a$exports","$38245ec463101f6a$var$url","$b4e14b6b8da86996$var$onLoad","localStorage","getItem","updateBold","option","options","fontWeight","selectedOptions","enumerateDevices","label","update","disabled","setItem","onchange","files","file","compressed","console","alert","onclick","pdfData","extracted","region","targetWidth","targetHeightOrTransfer","maybeTransfer","targetHeight","Boolean","payload","undefined","test","userAgent","transferList","res","rej","onmessage","terminate","pdfBlob","parent","currPages","slice","ok","$777da7615efb492e$exports","serviceWorker","register"],"version":3,"file":"scanner.95ddfe9b.js.map"}