let e;function t(e){return e&&e.__esModule?e.default:e}var i={},n={};n=function(e,t,i){if(t===self.location.origin)return e;var n=i?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))};let a=new URL(import.meta.resolve("a2Cve"));i=n(a.toString(),a.origin,!0);const r=()=>new Worker(i),o=[];if(navigator.hardwareConcurrency)for(let e=1;e<navigator.hardwareConcurrency;++e)o.push(r());const l=()=>o.pop()||r(),d=e=>o.push(e);let s=0;const h=async(e,t)=>new Promise((i,n)=>{let a=l(),r=s++,o=e=>{let{id:t,error:l,result:s}=e.data;if(t==r){if(l){let e=Error(l.message);e.stack=l.stack,e.name=l.name,n(e)}else i(s);d(a),a.removeEventListener("message",o)}};a.addEventListener("message",o),a.postMessage({id:r,msg:e},t||[])});function c(e,t){return h({type:"find-document",data:e},t?[e.data.buffer]:[])}const m=Blob.prototype.arrayBuffer||function(){return new Promise((e,t)=>{let i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=()=>{t(i.error)},i.readAsArrayBuffer(this)})},g=async e=>{let t=[],i=0,n=[],a=e=>{t.push(e),i+=e.length},r=e=>{a(" "),a(e)},o=e=>{let t=0;for(let i of e)t+=i.length;let i=new Uint8Array(t);for(let n of(t=0,e)){if("string"==typeof n)for(let e=0;e<n.length;++e)i[e+t]=n.charCodeAt(e);else i.set(n,t);t+=n.length}return i},l=e=>{a("%"+e+"\n")},d=e=>{r(e.toString())},s=e=>{r("/"+e)},h=e=>{r("["),e(),r("]")},c=e=>{for(let t in r("<<"),e)s(t),e[t]();r(">>")},g=(e,t)=>{if("undefined"!=typeof process&&null!=process.env&&"production"!==process.env.NODE_ENV&&!e.Length)throw TypeError("need stream length");c(e),r("stream\n"),a(t),a("endstream")},p=e=>(a(" "),a(n.push(i)+" 0 obj"),e(),r("endobj"),n.length),w=e=>{r(e+" 0 R")};l("PDF-1.4"),l("úã");let y=3*e.length+1,u=await Promise.all(e.map(async e=>{let t;if("undefined"!=typeof OffscreenCanvas){let i=new OffscreenCanvas(e.width,e.height);i.getContext("2d").putImageData(e,0,0),t=await i.convertToBlob({type:"image/jpeg"})}else if("undefined"!=typeof document){let i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),t=await new Promise(e=>i.toBlob(e,"image/jpeg"))}else throw Error("Cannot generate JPEG: no canvas or document available in worker context");let i=new Uint8Array(await m.call(t)),n=p(()=>{g({Type(){s("XObject")},Subtype(){s("Image")},Width(){d(e.width)},Height(){d(e.height)},ColorSpace(){s("DeviceRGB")},BitsPerComponent(){d(8)},Filter(){s("DCTDecode")},Length(){d(i.length)}},i)}),a=792*e.width/e.height,r=p(()=>{let e=`${a} 0 0 792 0 0 cm /I Do`;g({Length(){d(e.length)}},o([e]))});return p(()=>{c({Type(){s("Page")},Parent(){w(y)},Resources(){c({XObject(){c({I(){w(n)}})}})},Contents(){w(r)},MediaBox(){h(()=>{d(0),d(0),d(a),d(792)})}})})})),v=p(()=>{c({Type(){s("Pages")},Kids(){h(()=>{for(let e of u)w(e)})},Count(){d(u.length)}})}),f=p(()=>{c({Type(){s("Catalog")},Pages(){w(v)}})});a("\n");let E=i;for(let e of(a("xref\n0 "+(n.length+1)+"\n0000000000 65535 f \n"),n))a(e.toString().padStart(10,"0")+" 00000 n \n");return a("trailer"),c({Size(){d(n.length+1)},Root(){w(f)}}),a("\nstartxref\n"+E+"\n%%EOF"),o(t)},p=async e=>{let t=document.createElement("img"),i=new Promise((e,i)=>{t.onload=()=>{e()},t.onerror=e=>{i(e)}});return t.src=URL.createObjectURL(e),await i,URL.revokeObjectURL(t.src),t},w=document.createElement("canvas"),y=w.getContext("2d"),u=async(e,t)=>{if(w.transferControlToOffscreen){var i;return h({type:"get-data",bitmap:i=e instanceof ImageBitmap?e:await createImageBitmap(e)},t?[i]:[])}return w.width=e.width,w.height=e.height,y.drawImage(e,0,0),y.getImageData(0,0,e.width,e.height)};var v={};v=import.meta.resolve("bj76Q");var f={};f=import.meta.resolve("e0Dy9");var E={};E=import.meta.resolve("lX2gi");var x={};x=import.meta.resolve("gltHY");let C=window.ImageCapture;void 0===C&&(C=class{constructor(e){if("video"!==e.kind)throw new DOMException("NotSupportedError");this._videoStreamTrack=e,"readyState"in this._videoStreamTrack||(this._videoStreamTrack.readyState="live"),this._previewStream=new MediaStream([e]),this.videoElement=document.createElement("video"),this.videoElementPlaying=new Promise(e=>{this.videoElement.addEventListener("playing",e)}),HTMLMediaElement?this.videoElement.srcObject=this._previewStream:this.videoElement.src=URL.createObjectURL(this._previewStream),this.videoElement.muted=!0,this.videoElement.setAttribute("playsinline",""),this.videoElement.play(),this.canvasElement=document.createElement("canvas"),this.canvas2dContext=this.canvasElement.getContext("2d")}get videoStreamTrack(){return this._videoStreamTrack}getPhotoCapabilities(){return new Promise(function(e,t){let i={current:0,min:0,max:0};e({exposureCompensation:i,exposureMode:"none",fillLightMode:"none",focusMode:"none",imageHeight:i,imageWidth:i,iso:i,redEyeReduction:!1,whiteBalanceMode:"none",zoom:i}),t(new DOMException("OperationError"))})}setOptions(e={}){return new Promise(function(e,t){})}takePhoto(){let e=this;return new Promise(function(t,i){if("live"!==e._videoStreamTrack.readyState)return i(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),e.canvasElement.toBlob(t)}catch(e){i(new DOMException("UnknownError"))}})})}grabFrame(){let e=this;return new Promise(function(t,i){if("live"!==e._videoStreamTrack.readyState)return i(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),t(window.createImageBitmap(e.canvasElement))}catch(e){i(new DOMException("UnknownError"))}})})}}),window.ImageCapture=C;const b=document.getElementById("root"),I=document.getElementById("modal"),B=document.getElementById("captures"),L=document.getElementById("preview"),k=document.getElementById("preview-crop"),M=document.getElementById("preview-doc"),D=document.getElementById("bottom-wrapper"),S=document.getElementById("top-wrapper"),W=document.getElementById("camera-select-wrapper"),P=document.getElementById("camera-select"),H=document.getElementById("quality-wrapper"),O=document.getElementById("quality"),T=document.getElementById("quality-img"),R=document.getElementById("github-wrapper"),j=document.getElementById("flash-wrapper"),U=document.getElementById("flash"),_=document.getElementById("flash-img"),F=document.getElementById("past-wrapper"),A=document.getElementById("past"),X=document.getElementById("upload-wrapper"),q=document.getElementById("upload"),N=document.getElementById("shutter"),Y=document.getElementById("done-wrapper"),z=document.getElementById("done"),J=document.getElementById("modal-bottom-wrapper"),V=document.getElementById("modal-cancel-wrapper"),G=document.getElementById("modal-cancel"),$=document.getElementById("modal-done-wrapper"),K=document.getElementById("modal-done");let Q={};const Z=[],ee=[],et=e=>(ee.push(e),()=>{ee.splice(ee.indexOf(e),1)}),ei=()=>{for(let e of ee)e()};let en=-1;window.addEventListener("resize",()=>{clearTimeout(en),en=setTimeout(ei,250)},{passive:!0});const ea=t=>{let i={width:1e5,height:1e5,facingMode:"environment"};if(t){if(Q[t])return Q[t];i.deviceId={exact:t}}else if(e)return e;let n=navigator.mediaDevices.getUserMedia({video:i}).then(e=>{let t=e.getVideoTracks()[0].getSettings();for(let t of e.getTracks())t.stop();return{width:Math.max(t.width,t.height),height:Math.min(t.width,t.height),deviceId:t.deviceId}});return t?Q[t]=n:e=n.then(e=>(Q[e.deviceId]=n,e)),n},er=(e,t)=>{let i=document.createElement("div"),n=Math.min(window.innerWidth,window.innerHeight);return i.style.width=.03*n+"px",i.style.height=.03*n+"px",i.style.borderRadius=.015*n+"px",i.style.backgroundColor="black",i.style.position="absolute",eo(i,e,t),i},eo=(e,t,i)=>{let n=Math.min(window.innerWidth,window.innerHeight);e.style.top=t.y*i-.015*n+"px",e.style.left=t.x*i-.015*n+"px"},el=(e,t,i)=>{let n=document.createElement("div");return n.style.height="4px",n.style.backgroundColor="red",n.style.position="absolute",n.style.transformOrigin="center left",ed(n,e,t,i),n},ed=(e,t,i,n)=>{e.style.width=Math.hypot(t.x-i.x,t.y-i.y)*n+"px",e.style.top=t.y*n+"px",e.style.left=t.x*n+"px",e.style.transform=`rotate(${Math.atan2(i.y-t.y,i.x-t.x)}rad)`},es=async e=>{let t,i;if(e instanceof Blob){let n=await p(e);t=n,i=await u(n)}else{let n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),t=n,i=await u(e,!0)}let n=await c(i)||{a:{x:0,y:i.height},b:{x:0,y:0},c:{x:i.width,y:0},d:{x:i.width,y:i.height}},a=e=>{e.x<0?e.x=0:e.x>i.width&&(e.x=i.width),e.y<0?e.y=0:e.y>i.height&&(e.y=i.height)};return a(n.a),a(n.b),a(n.c),a(n.d),{img:t,data:i,quad:n}},eh=async e=>{let t=e.length,i=[],n={width:0,height:0},a=!1;for(let r=0;r<t;r++){let o=e[r],{img:l,data:d,quad:s}=o instanceof Blob||o instanceof ImageBitmap?await es(o):o,h=document.createElement("div");h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.scrollSnapAlign="center";let c=document.createElement("div");c.style.position="relative",c.appendChild(l),h.appendChild(c),I.style.display="flex";let m=Math.max(d.width,d.height)/Math.min(d.width,d.height),g=0,p=0,w=0,y=!1,u=[],v=()=>{if(!y){let{left:e,top:t}=c.getBoundingClientRect();p=e,w=t,y=!0}},f=(e,t)=>{let i=er(e,g),n=!1,a=(t,a,p)=>{i.parentElement==c?(t.target==i||t.target==l&&Math.hypot(a-e.x*g,p-e.y*g)<.2*Math.min(window.innerWidth,window.innerHeight))&&(t.stopImmediatePropagation(),n=!0,r(a,p)):(c.removeEventListener("mousedown",d),c.removeEventListener("touchstart",s),c.removeEventListener("mousemove",h),c.removeEventListener("touchmove",m),c.removeEventListener("mouseup",o),c.removeEventListener("touchend",o))},r=(n,a)=>{e.x=n/g,e.y=a/g,eo(i,e,g),t()},o=()=>{n=!1},d=e=>{v(),a(e,e.pageX-p,e.pageY-w)};c.addEventListener("mousedown",d);let s=e=>{let t=e.targetTouches[0];v(),a(e,t.pageX-p,t.pageY-w)};c.addEventListener("touchstart",s);let h=e=>{n&&(e.preventDefault(),r(e.pageX-p,e.pageY-w))};c.addEventListener("mousemove",h);let m=e=>{if(n){let t=e.targetTouches[0];e.preventDefault(),r(t.pageX-p,t.pageY-w)}};return c.addEventListener("touchmove",m),c.addEventListener("mouseup",o),c.addEventListener("touchend",o),i},E=()=>{for(let e of u)c.removeChild(e);let e=el(s.a,s.b,g),t=el(s.b,s.c,g),i=el(s.c,s.d,g),n=el(s.d,s.a,g);u=[c.appendChild(e),c.appendChild(t),c.appendChild(i),c.appendChild(n),c.appendChild(f(s.a,()=>{ed(n,s.d,s.a,g),ed(e,s.a,s.b,g)})),c.appendChild(f(s.b,()=>{ed(e,s.a,s.b,g),ed(t,s.b,s.c,g)})),c.appendChild(f(s.c,()=>{ed(t,s.b,s.c,g),ed(i,s.c,s.d,g)})),c.appendChild(f(s.d,()=>{ed(i,s.c,s.d,g),ed(n,s.d,s.a,g)}))]},x=()=>{let{width:e,height:t}=0===r?em(m,.925):n;0===r&&(a=ec(m),n={width:e,height:t},V.style.width=V.style.height=$.style.width=$.style.height=(a?window.innerWidth:window.innerHeight)*.035+"px",V.style.margin=$.style.margin=(a?window.innerWidth:window.innerHeight)*.02+"px",B.style.width=I.style.width=window.innerWidth+"px",B.style.height=I.style.height=window.innerHeight+"px",I.style.flexDirection=a?"row":"column",B.style.flexDirection=a?"column":"row",a?(J.style.flexDirection="column",J.style.height=window.innerHeight+"px",J.style.width=""):(J.style.flexDirection="row",J.style.height="",J.style.width=window.innerWidth+"px"));let i=e+"px",o=t+"px";a?(l.style.width="",l.style.height=o,g=window.innerHeight/d.height):(l.style.width=i,l.style.height="",g=window.innerWidth/d.width),h.style.width=h.style.minWidth=i,h.style.height=h.style.minHeight=o,y=!1,E()};x(),B.appendChild(h);let C=et(x);i.push(e=>{if(e&&(Z.push({data:d,quad:s,img:l}),Y.style.opacity="",r===t-1)){for(l.width>l.height?(l.style.height=F.style.height,l.style.width=""):(l.style.height="",l.style.width=F.style.width);F.lastChild!=A;)F.removeChild(F.lastChild);F.appendChild(l)}C(),B.removeChild(h)})}return new Promise(e=>{let t=()=>a(!0),n=()=>a(!1);G.addEventListener("click",n),K.addEventListener("click",t);let a=a=>{for(let e of(K.removeEventListener("click",t),G.removeEventListener("click",n),I.style.display="none",i))e(a);e(a)}})},ec=e=>window.innerWidth>window.innerHeight*e,em=(e,t)=>{let i=ec(e),n=i?window.innerHeight:Math.floor(Math.min(window.innerWidth*e,window.innerHeight*t));return{width:i?Math.floor(Math.min(window.innerHeight*e,window.innerWidth*t)):window.innerWidth,height:n}},eg=[S,D],ep=[j,H,R,W,F],ew=[Y,X],ey=ep.concat(ew,N),eu=async e=>{let i=await ea(e),n=i.width/i.height,a=ec(n),{width:r,height:o}=em(n,.84),l=o+"px",d=r+"px";for(let e of(k.style.width=k.style.minWidth=d,k.style.height=k.style.minHeight=l,b.style.width=window.innerWidth+"px",b.style.height=window.innerHeight+"px",eg))a?(e.style.flexDirection="column",e.style.height=window.innerHeight+"px",e.style.width=""):(e.style.flexDirection="row",e.style.height="",e.style.width=window.innerWidth+"px");for(let e of ep)e.style.width=e.style.height=(a?window.innerWidth:window.innerHeight)*.03+"px";for(let e of ew)e.style.width=e.style.height=(a?window.innerWidth:window.innerHeight)*.035+"px";for(let e of ey)e.style.margin=(a?window.innerWidth:window.innerHeight)*.02+"px";N.style.width=N.style.height=(a?window.innerWidth:window.innerHeight)*.05+"px";let s=(a?window.innerWidth:window.innerHeight)*.002+"px";F.style.borderRadius=s,F.style.border=s+" solid white",a?(L.style.height=l,L.style.width="",b.style.flexDirection="row"):(L.style.height="",L.style.width=d,b.style.flexDirection="column");let h={width:i.width,height:i.height,deviceId:{exact:i.deviceId}},m=await navigator.mediaDevices.getUserMedia({video:h}),g=m.getVideoTracks()[0],p=g.getCapabilities();j.style.display=p.torch?"":"none",L.srcObject=m;let w=[],y=()=>{for(let e of w)M.removeChild(e);w.length=0},C=()=>{let e=a?window.innerHeight/L.videoHeight:window.innerWidth/L.videoWidth,t=async()=>{let i,n=performance.now();"none"==I.style.display&&(i=await c(await u(await B.grabFrame()),!0)),y(),-1!=W&&(i&&(w=[M.appendChild(el(i.a,i.b,e)),M.appendChild(el(i.b,i.c,e)),M.appendChild(el(i.c,i.d,e)),M.appendChild(el(i.d,i.a,e))]),W=setTimeout(t,Math.max(250-performance.now()+n,0)))};W=setTimeout(t,0)};L.addEventListener("loadedmetadata",C);let B=new ImageCapture(g),D="[object ImageCapture]"==Object.prototype.toString.call(B);H.style.display=D?"":"none",T.src=t(E);let S=()=>{T.src=(D=!D)?t(E):t(x)};O.addEventListener("click",S);let W=-1,P=()=>{L.style.opacity="0",setTimeout(()=>L.style.opacity="",50)},R=async()=>{if(""==N.style.opacity){N.style.opacity="0.5",P();try{let e=D?await B.takePhoto():await B.grabFrame();e=await ev(e),await eh([e])}catch(e){}N.style.opacity=""}};N.addEventListener("click",R);let A=!1;_.src=t(f);let X=async()=>{try{A=!A,await g.applyConstraints({advanced:[{torch:A}]}),_.src=A?t(v):t(f)}catch(e){}};return U.addEventListener("click",X),{deviceId:i.deviceId,close(){for(let e of(clearTimeout(W),W=-1,N.removeEventListener("click",R),U.removeEventListener("click",X),O.removeEventListener("click",S),L.removeEventListener("loadedmetadata",C),L.pause(),m.getTracks()))e.stop()}}};async function ev(e,t=1024,i=.8){let n,a=Math.min(1,t/(n=e instanceof Blob?await createImageBitmap(e):e).width,t/n.height),r=Math.round(n.width*a),o=Math.round(n.height*a),l=document.createElement("canvas");return l.width=r,l.height=o,l.getContext("2d").drawImage(n,0,0,r,o),await new Promise((e,t)=>{l.toBlob(i=>{i?e(i):t(Error("Compression failed"))},"image/jpeg",i)})}var ef={};let eE=new URL(import.meta.resolve("2E4nm"));ef=n(eE.toString(),eE.origin,!0),(async()=>{let e=await eu(localStorage.getItem("defaultDevice")),t=()=>{for(let e of P.options)e.style.fontWeight="";P.selectedOptions[0].style.fontWeight="bold"};for(let e of(await navigator.mediaDevices.enumerateDevices()))if("videoinput"==e.kind){let t=document.createElement("option");t.value=e.deviceId,t.label=e.label,P.appendChild(t)}P.value=e.deviceId,t();let i=async()=>{t(),e.close(),P.disabled=!0,localStorage.setItem("defaultDevice",P.value),e=await eu(P.value),P.disabled=!1};P.onchange=i,q.onchange=async()=>{N.style.opacity="0.5";let e=[...q.files];try{for(let t of e){let e=await ev(t);await eh([e])}}catch(e){console.error("Error processing uploaded files",e),alert("Error processing uploaded images: "+e.message)}finally{N.style.opacity="",q.value=""}},z.onclick=async()=>{if(Z.length){Y.style.opacity="0.5";try{let e;for(;F.lastChild!=A;)F.removeChild(F.lastChild);let t=await Promise.all(Z.map(({data:e,quad:t})=>(function(e,t,i,n,a){let r,o;"number"==typeof n?(r=n,o=!1):o=!!n;let l={type:"extract-document",data:e,region:t,targetWidth:1224};return void 0!==r&&(l.targetHeight=r),h(l,o?[e.data.buffer]:[])})(e,t,0,!0)));if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||"undefined"==typeof OffscreenCanvas||"function"!=typeof new OffscreenCanvas(1,1).convertToBlob)e=await g(t);else{let i=new Worker(ef),n=t.map(({data:e})=>e.buffer);e=await new Promise((e,a)=>{i.onmessage=t=>{let i=t.data;i.error?a(Error(i.error)):e(i)},i.onerror=e=>a(e),i.postMessage(t,n)}),i.terminate()}let i=new Blob([e],{type:"application/pdf"});window.parent.postMessage({type:"scannedPDF",blob:i},"*"),Z.length=0}catch(e){console.error("Error generating PDF",e),alert("Failed to generate PDF: "+e.message)}finally{Y.style.opacity=""}}},A.onclick=async()=>{if(!Z.length)return;let e=Z.slice();Z.length=0;let t=!1;try{t=await eh(e)}catch(e){console.error("Error re-processing pages",e),alert("Error re-processing pages: "+e.message)}if(!t){Z.push(...e);let{img:t}=e[e.length-1];for(t.width>t.height?(t.style.height=F.style.height,t.style.width=""):(t.style.height="",t.style.width=F.style.width);F.lastChild!=A;)F.removeChild(F.lastChild);F.appendChild(t)}}})();var ex={};ex=import.meta.resolve("drXuR"),navigator.serviceWorker.register(ex);
//# sourceMappingURL=scanner.95ddfe9b.js.map
