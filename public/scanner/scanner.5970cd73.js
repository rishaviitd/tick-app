let e;function t(e){return e&&e.__esModule?e.default:e}var i={},n={};n=function(e,t,i){if(t===self.location.origin)return e;var n=i?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))};let r=new URL(import.meta.resolve("a2Cve"));i=n(r.toString(),r.origin,!0);const a=()=>new Worker(i),o=[];if(navigator.hardwareConcurrency)for(let e=1;e<navigator.hardwareConcurrency;++e)o.push(a());const l=()=>o.pop()||a(),d=e=>o.push(e);let s=0;const h=async(e,t)=>new Promise((i,n)=>{let r=l(),a=s++,o=e=>{let{id:t,error:l,result:s}=e.data;if(t==a){if(l){let e=Error(l.message);e.stack=l.stack,e.name=l.name,n(e)}else i(s);d(r),r.removeEventListener("message",o)}};r.addEventListener("message",o),r.postMessage({id:a,msg:e},t||[])});function c(e,t){return h({type:"find-document",data:e},t?[e.data.buffer]:[])}const m=Blob.prototype.arrayBuffer||function(){return new Promise((e,t)=>{let i=new FileReader;i.onload=()=>{e(i.result)},i.onerror=()=>{t(i.error)},i.readAsArrayBuffer(this)})},g=async e=>{let t=[],i=0,n=[],r=e=>{t.push(e),i+=e.length},a=e=>{r(" "),r(e)},o=e=>{let t=0;for(let i of e)t+=i.length;let i=new Uint8Array(t);for(let n of(t=0,e)){if("string"==typeof n)for(let e=0;e<n.length;++e)i[e+t]=n.charCodeAt(e);else i.set(n,t);t+=n.length}return i},l=e=>{r("%"+e+"\n")},d=e=>{a(e.toString())},s=e=>{a("/"+e)},h=e=>{a("["),e(),a("]")},c=e=>{for(let t in a("<<"),e)s(t),e[t]();a(">>")},g=(e,t)=>{if("undefined"!=typeof process&&null!=process.env&&"production"!==process.env.NODE_ENV&&!e.Length)throw TypeError("need stream length");c(e),a("stream\n"),r(t),r("endstream")},p=e=>(r(" "),r(n.push(i)+" 0 obj"),e(),a("endobj"),n.length),w=e=>{a(e+" 0 R")};l("PDF-1.4"),l("úã");let y=3*e.length+1,u=await Promise.all(e.map(async e=>{let t;if("undefined"!=typeof OffscreenCanvas){let i=new OffscreenCanvas(e.width,e.height);i.getContext("2d").putImageData(e,0,0),t=await i.convertToBlob({type:"image/jpeg"})}else if("undefined"!=typeof document){let i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),t=await new Promise(e=>i.toBlob(e,"image/jpeg"))}else throw Error("Cannot generate JPEG: no canvas or document available in worker context");let i=new Uint8Array(await m.call(t)),n=p(()=>{g({Type(){s("XObject")},Subtype(){s("Image")},Width(){d(e.width)},Height(){d(e.height)},ColorSpace(){s("DeviceRGB")},BitsPerComponent(){d(8)},Filter(){s("DCTDecode")},Length(){d(i.length)}},i)}),r=792*e.width/e.height,a=p(()=>{let e=`${r} 0 0 792 0 0 cm /I Do`;g({Length(){d(e.length)}},o([e]))});return p(()=>{c({Type(){s("Page")},Parent(){w(y)},Resources(){c({XObject(){c({I(){w(n)}})}})},Contents(){w(a)},MediaBox(){h(()=>{d(0),d(0),d(r),d(792)})}})})})),v=p(()=>{c({Type(){s("Pages")},Kids(){h(()=>{for(let e of u)w(e)})},Count(){d(u.length)}})}),f=p(()=>{c({Type(){s("Catalog")},Pages(){w(v)}})});r("\n");let E=i;for(let e of(r("xref\n0 "+(n.length+1)+"\n0000000000 65535 f \n"),n))r(e.toString().padStart(10,"0")+" 00000 n \n");return r("trailer"),c({Size(){d(n.length+1)},Root(){w(f)}}),r("\nstartxref\n"+E+"\n%%EOF"),o(t)},p=async e=>{let t=document.createElement("img"),i=new Promise((e,i)=>{t.onload=()=>{e()},t.onerror=e=>{i(e)}});return t.src=URL.createObjectURL(e),await i,URL.revokeObjectURL(t.src),t},w=document.createElement("canvas"),y=w.getContext("2d"),u=async(e,t)=>{if(w.transferControlToOffscreen){var i;return h({type:"get-data",bitmap:i=e instanceof ImageBitmap?e:await createImageBitmap(e)},t?[i]:[])}return w.width=e.width,w.height=e.height,y.drawImage(e,0,0),y.getImageData(0,0,e.width,e.height)},v=(e,t)=>{let i=URL.createObjectURL(e),n=document.createElement("a");n.download=t,n.href=i,n.click(),URL.revokeObjectURL(i)};var f={};f=import.meta.resolve("bj76Q");var E={};E=import.meta.resolve("e0Dy9");var x={};x=import.meta.resolve("lX2gi");var C={};C=import.meta.resolve("gltHY");let b=window.ImageCapture;void 0===b&&(b=class{constructor(e){if("video"!==e.kind)throw new DOMException("NotSupportedError");this._videoStreamTrack=e,"readyState"in this._videoStreamTrack||(this._videoStreamTrack.readyState="live"),this._previewStream=new MediaStream([e]),this.videoElement=document.createElement("video"),this.videoElementPlaying=new Promise(e=>{this.videoElement.addEventListener("playing",e)}),HTMLMediaElement?this.videoElement.srcObject=this._previewStream:this.videoElement.src=URL.createObjectURL(this._previewStream),this.videoElement.muted=!0,this.videoElement.setAttribute("playsinline",""),this.videoElement.play(),this.canvasElement=document.createElement("canvas"),this.canvas2dContext=this.canvasElement.getContext("2d")}get videoStreamTrack(){return this._videoStreamTrack}getPhotoCapabilities(){return new Promise(function(e,t){let i={current:0,min:0,max:0};e({exposureCompensation:i,exposureMode:"none",fillLightMode:"none",focusMode:"none",imageHeight:i,imageWidth:i,iso:i,redEyeReduction:!1,whiteBalanceMode:"none",zoom:i}),t(new DOMException("OperationError"))})}setOptions(e={}){return new Promise(function(e,t){})}takePhoto(){let e=this;return new Promise(function(t,i){if("live"!==e._videoStreamTrack.readyState)return i(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),e.canvasElement.toBlob(t)}catch(e){i(new DOMException("UnknownError"))}})})}grabFrame(){let e=this;return new Promise(function(t,i){if("live"!==e._videoStreamTrack.readyState)return i(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),t(window.createImageBitmap(e.canvasElement))}catch(e){i(new DOMException("UnknownError"))}})})}}),window.ImageCapture=b;const I=document.getElementById("root"),B=document.getElementById("modal"),L=document.getElementById("captures"),k=document.getElementById("preview"),M=document.getElementById("preview-crop"),D=document.getElementById("preview-doc"),S=document.getElementById("bottom-wrapper"),W=document.getElementById("top-wrapper"),O=document.getElementById("camera-select-wrapper"),H=document.getElementById("camera-select"),P=document.getElementById("quality-wrapper"),T=document.getElementById("quality"),R=document.getElementById("quality-img"),U=document.getElementById("github-wrapper"),j=document.getElementById("flash-wrapper"),_=document.getElementById("flash"),F=document.getElementById("flash-img"),A=document.getElementById("past-wrapper"),X=document.getElementById("past"),q=document.getElementById("upload-wrapper"),N=document.getElementById("upload"),Y=document.getElementById("shutter"),z=document.getElementById("done-wrapper"),J=document.getElementById("done"),V=document.getElementById("modal-bottom-wrapper"),G=document.getElementById("modal-cancel-wrapper"),$=document.getElementById("modal-cancel"),K=document.getElementById("modal-done-wrapper"),Q=document.getElementById("modal-done");let Z={};const ee=[],et=[],ei=e=>(et.push(e),()=>{et.splice(et.indexOf(e),1)}),en=()=>{for(let e of et)e()};let er=-1;window.addEventListener("resize",()=>{clearTimeout(er),er=setTimeout(en,250)},{passive:!0});const ea=t=>{let i={width:1e5,height:1e5,facingMode:"environment"};if(t){if(Z[t])return Z[t];i.deviceId={exact:t}}else if(e)return e;let n=navigator.mediaDevices.getUserMedia({video:i}).then(e=>{let t=e.getVideoTracks()[0].getSettings();for(let t of e.getTracks())t.stop();return{width:Math.max(t.width,t.height),height:Math.min(t.width,t.height),deviceId:t.deviceId}});return t?Z[t]=n:e=n.then(e=>(Z[e.deviceId]=n,e)),n},eo=(e,t)=>{let i=document.createElement("div"),n=Math.min(window.innerWidth,window.innerHeight);return i.style.width=.03*n+"px",i.style.height=.03*n+"px",i.style.borderRadius=.015*n+"px",i.style.backgroundColor="black",i.style.position="absolute",el(i,e,t),i},el=(e,t,i)=>{let n=Math.min(window.innerWidth,window.innerHeight);e.style.top=t.y*i-.015*n+"px",e.style.left=t.x*i-.015*n+"px"},ed=(e,t,i)=>{let n=document.createElement("div");return n.style.height="4px",n.style.backgroundColor="red",n.style.position="absolute",n.style.transformOrigin="center left",es(n,e,t,i),n},es=(e,t,i,n)=>{e.style.width=Math.hypot(t.x-i.x,t.y-i.y)*n+"px",e.style.top=t.y*n+"px",e.style.left=t.x*n+"px",e.style.transform=`rotate(${Math.atan2(i.y-t.y,i.x-t.x)}rad)`},eh=async e=>{let t,i;if(e instanceof Blob){let n=await p(e);t=n,i=await u(n)}else{let n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),t=n,i=await u(e,!0)}let n=await c(i)||{a:{x:0,y:i.height},b:{x:0,y:0},c:{x:i.width,y:0},d:{x:i.width,y:i.height}},r=e=>{e.x<0?e.x=0:e.x>i.width&&(e.x=i.width),e.y<0?e.y=0:e.y>i.height&&(e.y=i.height)};return r(n.a),r(n.b),r(n.c),r(n.d),{img:t,data:i,quad:n}},ec=async e=>{let t=e.length,i=[],n={width:0,height:0},r=!1;for(let a=0;a<t;a++){let o=e[a],{img:l,data:d,quad:s}=o instanceof Blob||o instanceof ImageBitmap?await eh(o):o,h=document.createElement("div");h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.scrollSnapAlign="center";let c=document.createElement("div");c.style.position="relative",c.appendChild(l),h.appendChild(c),B.style.display="flex";let m=Math.max(d.width,d.height)/Math.min(d.width,d.height),g=0,p=0,w=0,y=!1,u=[],v=()=>{if(!y){let{left:e,top:t}=c.getBoundingClientRect();p=e,w=t,y=!0}},f=(e,t)=>{let i=eo(e,g),n=!1,r=(t,r,p)=>{i.parentElement==c?(t.target==i||t.target==l&&Math.hypot(r-e.x*g,p-e.y*g)<.2*Math.min(window.innerWidth,window.innerHeight))&&(t.stopImmediatePropagation(),n=!0,a(r,p)):(c.removeEventListener("mousedown",d),c.removeEventListener("touchstart",s),c.removeEventListener("mousemove",h),c.removeEventListener("touchmove",m),c.removeEventListener("mouseup",o),c.removeEventListener("touchend",o))},a=(n,r)=>{e.x=n/g,e.y=r/g,el(i,e,g),t()},o=()=>{n=!1},d=e=>{v(),r(e,e.pageX-p,e.pageY-w)};c.addEventListener("mousedown",d);let s=e=>{let t=e.targetTouches[0];v(),r(e,t.pageX-p,t.pageY-w)};c.addEventListener("touchstart",s);let h=e=>{n&&(e.preventDefault(),a(e.pageX-p,e.pageY-w))};c.addEventListener("mousemove",h);let m=e=>{if(n){let t=e.targetTouches[0];e.preventDefault(),a(t.pageX-p,t.pageY-w)}};return c.addEventListener("touchmove",m),c.addEventListener("mouseup",o),c.addEventListener("touchend",o),i},E=()=>{for(let e of u)c.removeChild(e);let e=ed(s.a,s.b,g),t=ed(s.b,s.c,g),i=ed(s.c,s.d,g),n=ed(s.d,s.a,g);u=[c.appendChild(e),c.appendChild(t),c.appendChild(i),c.appendChild(n),c.appendChild(f(s.a,()=>{es(n,s.d,s.a,g),es(e,s.a,s.b,g)})),c.appendChild(f(s.b,()=>{es(e,s.a,s.b,g),es(t,s.b,s.c,g)})),c.appendChild(f(s.c,()=>{es(t,s.b,s.c,g),es(i,s.c,s.d,g)})),c.appendChild(f(s.d,()=>{es(i,s.c,s.d,g),es(n,s.d,s.a,g)}))]},x=()=>{let{width:e,height:t}=0===a?eg(m,.925):n;0===a&&(r=em(m),n={width:e,height:t},G.style.width=G.style.height=K.style.width=K.style.height=(r?window.innerWidth:window.innerHeight)*.035+"px",G.style.margin=K.style.margin=(r?window.innerWidth:window.innerHeight)*.02+"px",L.style.width=B.style.width=window.innerWidth+"px",L.style.height=B.style.height=window.innerHeight+"px",B.style.flexDirection=r?"row":"column",L.style.flexDirection=r?"column":"row",r?(V.style.flexDirection="column",V.style.height=window.innerHeight+"px",V.style.width=""):(V.style.flexDirection="row",V.style.height="",V.style.width=window.innerWidth+"px"));let i=e+"px",o=t+"px";r?(l.style.width="",l.style.height=o,g=window.innerHeight/d.height):(l.style.width=i,l.style.height="",g=window.innerWidth/d.width),h.style.width=h.style.minWidth=i,h.style.height=h.style.minHeight=o,y=!1,E()};x(),L.appendChild(h);let C=ei(x);i.push(e=>{if(e&&(ee.push({data:d,quad:s,img:l}),z.style.opacity="",a===t-1)){for(l.width>l.height?(l.style.height=A.style.height,l.style.width=""):(l.style.height="",l.style.width=A.style.width);A.lastChild!=X;)A.removeChild(A.lastChild);A.appendChild(l)}C(),L.removeChild(h)})}return new Promise(e=>{let t=()=>r(!0),n=()=>r(!1);$.addEventListener("click",n),Q.addEventListener("click",t);let r=r=>{for(let e of(Q.removeEventListener("click",t),$.removeEventListener("click",n),B.style.display="none",i))e(r);e(r)}})},em=e=>window.innerWidth>window.innerHeight*e,eg=(e,t)=>{let i=em(e),n=i?window.innerHeight:Math.floor(Math.min(window.innerWidth*e,window.innerHeight*t));return{width:i?Math.floor(Math.min(window.innerHeight*e,window.innerWidth*t)):window.innerWidth,height:n}},ep=[W,S],ew=[j,P,U,O,A],ey=[z,q],eu=ew.concat(ey,Y),ev=async e=>{let i=await ea(e),n=i.width/i.height,r=em(n),{width:a,height:o}=eg(n,.84),l=o+"px",d=a+"px";for(let e of(M.style.width=M.style.minWidth=d,M.style.height=M.style.minHeight=l,I.style.width=window.innerWidth+"px",I.style.height=window.innerHeight+"px",ep))r?(e.style.flexDirection="column",e.style.height=window.innerHeight+"px",e.style.width=""):(e.style.flexDirection="row",e.style.height="",e.style.width=window.innerWidth+"px");for(let e of ew)e.style.width=e.style.height=(r?window.innerWidth:window.innerHeight)*.03+"px";for(let e of ey)e.style.width=e.style.height=(r?window.innerWidth:window.innerHeight)*.035+"px";for(let e of eu)e.style.margin=(r?window.innerWidth:window.innerHeight)*.02+"px";Y.style.width=Y.style.height=(r?window.innerWidth:window.innerHeight)*.05+"px";let s=(r?window.innerWidth:window.innerHeight)*.002+"px";A.style.borderRadius=s,A.style.border=s+" solid white",r?(k.style.height=l,k.style.width="",I.style.flexDirection="row"):(k.style.height="",k.style.width=d,I.style.flexDirection="column");let h={width:i.width,height:i.height,deviceId:{exact:i.deviceId}},m=await navigator.mediaDevices.getUserMedia({video:h}),g=m.getVideoTracks()[0],p=g.getCapabilities();j.style.display=p.torch?"":"none",k.srcObject=m;let w=[],y=()=>{for(let e of w)D.removeChild(e);w.length=0},v=()=>{let e=r?window.innerHeight/k.videoHeight:window.innerWidth/k.videoWidth,t=async()=>{let i,n=performance.now();"none"==B.style.display&&(i=await c(await u(await b.grabFrame()),!0)),y(),-1!=W&&(i&&(w=[D.appendChild(ed(i.a,i.b,e)),D.appendChild(ed(i.b,i.c,e)),D.appendChild(ed(i.c,i.d,e)),D.appendChild(ed(i.d,i.a,e))]),W=setTimeout(t,Math.max(250-performance.now()+n,0)))};W=setTimeout(t,0)};k.addEventListener("loadedmetadata",v);let b=new ImageCapture(g),L="[object ImageCapture]"==Object.prototype.toString.call(b);P.style.display=L?"":"none",R.src=t(x);let S=()=>{R.src=(L=!L)?t(x):t(C)};T.addEventListener("click",S);let W=-1,O=()=>{k.style.opacity="0",setTimeout(()=>k.style.opacity="",50)},H=async()=>{if(""==Y.style.opacity){Y.style.opacity="0.5",O();try{let e=L?await b.takePhoto():await b.grabFrame();await ec([e])}catch(e){}Y.style.opacity=""}};Y.addEventListener("click",H);let U=!1;F.src=t(E);let X=async()=>{try{U=!U,await g.applyConstraints({advanced:[{torch:U}]}),F.src=U?t(f):t(E)}catch(e){}};return _.addEventListener("click",X),{deviceId:i.deviceId,close(){for(let e of(clearTimeout(W),W=-1,Y.removeEventListener("click",H),_.removeEventListener("click",X),T.removeEventListener("click",S),k.removeEventListener("loadedmetadata",v),k.pause(),m.getTracks()))e.stop()}}};var ef={};let eE=new URL(import.meta.resolve("2E4nm"));ef=n(eE.toString(),eE.origin,!0),(async()=>{let e=await ev(localStorage.getItem("defaultDevice")),t=()=>{for(let e of H.options)e.style.fontWeight="";H.selectedOptions[0].style.fontWeight="bold"};for(let e of(await navigator.mediaDevices.enumerateDevices()))if("videoinput"==e.kind){let t=document.createElement("option");t.value=e.deviceId,t.label=e.label,H.appendChild(t)}H.value=e.deviceId,t();let i=async()=>{t(),e.close(),H.disabled=!0,localStorage.setItem("defaultDevice",H.value),e=await ev(H.value),H.disabled=!1};H.onchange=i,N.onchange=async()=>{Y.style.opacity="0.5";try{await ec([...N.files])}catch(e){console.error("Error processing uploaded files",e),alert("Error processing uploaded images: "+e.message)}finally{Y.style.opacity=""}},J.onclick=async()=>{if(ee.length){z.style.opacity="0.5";try{let e;for(;A.lastChild!=X;)A.removeChild(A.lastChild);let t=await Promise.all(ee.map(({data:e,quad:t})=>(function(e,t,i,n,r){let a,o;"number"==typeof n?(a=n,o=!1):o=!!n;let l={type:"extract-document",data:e,region:t,targetWidth:1224};return void 0!==a&&(l.targetHeight=a),h(l,o?[e.data.buffer]:[])})(e,t,0,!0)));if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||"undefined"==typeof OffscreenCanvas||"function"!=typeof new OffscreenCanvas(1,1).convertToBlob)e=await g(t);else{let i=new Worker(ef),n=t.map(({data:e})=>e.buffer);e=await new Promise((e,r)=>{i.onmessage=t=>{let i=t.data;i.error?r(Error(i.error)):e(i)},i.onerror=e=>r(e),i.postMessage(t,n)}),i.terminate()}let i=new Blob([e],{type:"application/pdf"});v(i,"out.pdf"),ee.length=0}catch(e){console.error("Error generating PDF",e),alert("Failed to generate PDF: "+e.message)}finally{z.style.opacity=""}}},X.onclick=async()=>{if(!ee.length)return;let e=ee.slice();ee.length=0;let t=!1;try{t=await ec(e)}catch(e){console.error("Error re-processing pages",e),alert("Error re-processing pages: "+e.message)}if(!t){ee.push(...e);let{img:t}=e[e.length-1];for(t.width>t.height?(t.style.height=A.style.height,t.style.width=""):(t.style.height="",t.style.width=A.style.width);A.lastChild!=X;)A.removeChild(A.lastChild);A.appendChild(t)}}})();var ex={};ex=import.meta.resolve("drXuR"),navigator.serviceWorker.register(ex);
//# sourceMappingURL=scanner.5970cd73.js.map
